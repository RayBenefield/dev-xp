import log from '@dev-xp/log'
import { has, get } from 'lodash'

// eslint-disable-next-line complexity
export default (title, path, logger = log) => value => {
    if (!title) {
        logger(value)
        return Promise.resolve(value)
    }
    if (typeof title === 'function') {
        title(value)
        return Promise.resolve(value)
    }
    if (title && !path) {
        if (has(value, title)) {
            logger(get(value, title))
            return Promise.resolve(value)
        }
        logger(title, value)
        return Promise.resolve(value)
    }
    if (title && typeof path === 'function') {
        if (has(value, title)) {
            path(get(value, title))
            return Promise.resolve(value)
        }
        path(title, value)
        return Promise.resolve(value)
    }
    if (title && path) {
        if (has(value, path)) {
            logger(title, get(value, path))
            return Promise.resolve(value)
        }
        logger(title, value)
        return Promise.resolve(value)
    }
    return Promise.resolve(value)
}
