import * as _ from '@dev-xp/utils'
import doStuff from '@transmutation/side-effect-operator'

export default (iterable, stream) => value =>
    Promise.all(
        _.getProp(iterable, value).map(iterator => stream(value, iterator))
    ).then(results => results.reduce((v, result) => doStuff(v)(result), value))
