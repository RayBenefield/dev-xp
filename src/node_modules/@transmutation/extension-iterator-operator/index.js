import { get } from 'dot-prop'
import extend from '@transmutation/extension-operator'

export default (iterable, stream) => value =>
    Promise.all(
        get(value, iterable).map(iterator => stream(value, iterator))
    ).then(results => results.reduce((v, result) => extend(v)(result), value))
