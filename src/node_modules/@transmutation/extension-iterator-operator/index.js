import * as _ from '@dev-xp/utils'
import extend from '@transmutation/extension-operator'

export default (iterable, stream) => value =>
    Promise.all(
        _.getProp(iterable, value).map(iterator => stream(value, iterator))
    ).then(results => results.reduce((v, result) => extend(v)(result), value))
