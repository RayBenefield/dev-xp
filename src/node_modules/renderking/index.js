import parser from '@renderking/parser'
import styler from '@renderking/styler'

const leftTrimFirstNode = (node, index) =>
    index === 0 && node.type === 'text'
        ? { ...node, text: node.text.trimLeft() }
        : node

export default style => template =>
    parser(template)
        .map(leftTrimFirstNode)
        .reduce((all, node) => {
            const newNode = styler(style)({
                node,
                previous: all[all.length - 1],
            })
            if (newNode.value) return [...all, newNode]
            return all
        }, [])
        .map(node => node.value)
        .join('')
        .trim()
