import createMixerChat from '@rampant/create-mixer-chat'
import { tap } from 'rxjs/operators'

export default ({ clientId, db }) => {
    const mixerChat = createMixerChat({ clientId, db })

    return {
        sources: {
            'mixer-chat': ({ channelId, userId }) =>
                mixerChat({ channelId, userId }),
        },
        effects: {
            message: ({ text, userId, channelId }) =>
                tap(() => {
                    mixerChat({ channelId, userId }).then(chat =>
                        chat.message(text)
                    )
                }),
        },
    }
}
