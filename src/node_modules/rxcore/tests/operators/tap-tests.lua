local assert = require('luassert')
local assertAll = require('assert-all')

local rx = require('rx')
local of = require('rx.observable.of')
local from = require('rx.observable.from')
local tap = require('rx.operators.tap')

describe('Tap Operator', function()
    describe('tap()', function()
        it('is included in rx object', function()
            assert.no.is_nil(rx.operators.tap)
        end)

        it('handles single value', function()
            local test_ = of('hello')
            local seen = 0
            local see = function() seen = seen + 1 end

            test_.pipe(tap(see)).subscribe(
                nil,
                nil,
                function() assert.are.equal(seen, 1) end
            )
        end)

        it('handles multiple values', function()
            local test_ = from({'hello', 'world', 'today'})
            local seen = 0
            local see = function() seen = seen + 1 end

            test_.pipe(tap(see)).subscribe(
                nil,
                nil,
                function()
                    assert.are.equal(seen, 3)
                end
            )
        end)
    end)
end)
