local assert = require('luassert')
local assertAll = require('assert-all')

local rx = require('rx')
local of = require('rx.observable.of')
local from = require('rx.observable.from')
local log = require('rx.operators.log')

describe('Log Operator', function()
    describe('log()', function()
        it('is included in rx object', function()
            assert.no.is_nil(rx.operators.log)
        end)

        it('handles single value', function()
            local test_ = of('hello')

            test_.pipe(log()).subscribe(function(val)
                assert.are.equal('hello', val)
            end)
        end)

        it('handles multiple values', function()
            local test_ = from({'hello', 'world', 'today'})

            test_.pipe(log()).subscribe(
                assertAll({'hello', 'world', 'today'}),
                nil,
                function()
                    print('done')
                end
            )
        end)

        it('logs tables with key values', function()
            local test_ = of({test = 'hello', again = 'world', final = 'today'})

            test_.pipe(log()).subscribe(
                function(val)
                    assert.are.same({test = 'hello', again = 'world', final = 'today'}, val)
                end,
                nil,
                function()
                    print('done')
                end
            )
        end)
    end)
end)
