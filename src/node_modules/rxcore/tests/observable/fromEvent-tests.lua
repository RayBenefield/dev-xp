local expect, printed = require'rx-test'()
local rx, _, util = require'rxcore'()
local global = require('lua-global')
local assert = require('luassert')
local spy = require('luassert.spy')

local connection = {}
local disconnectSpy = spy.new(function(self)
    assert.are.equal(connection, self)
end)
connection.Disconnect = disconnectSpy
local connectSpy = spy.new(function(name, handler)
    handler(name)
    return connection
end)
local eventsSpy = {
    Connect = connectSpy,
}

global('Events', eventsSpy)

describe('FromEvent Observable', function()
    describe('fromEvent()', function()

        it('connects to event and disconnects on unsubscribe', function()
            local test_ = rx.fromEvent('generate-maze').pipe(_.take(1))
            --
            expect(test_).to.produce('generate-maze')
            assert.spy(connectSpy).was.called(1)
            assert.spy(disconnectSpy).was.called(1)
        end)

    end)
end)
