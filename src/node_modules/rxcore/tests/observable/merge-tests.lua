local expect = require('rx-test')

local rx = require('rx')
local of = require('rx.observable.of')
local from = require('rx.observable.from')
local merge = require('rx.observable.merge')

describe('Merge Operator', function()
    describe('merge()', function()
        it('is included in rx object', function()
            assert.no.is_nil(rx.observable.merge)
        end)

        it('handles one observable', function()
            local test_ = merge(of('hello'))

            expect(test_).to.produce('hello')
        end)

        it('handles two observables', function()
            local test_ = merge(of('hello'), of('world'))

            expect(test_).to.produce('hello', 'world')
        end)

        it('handles expected order of observables', function()
            local test_ = merge(of('hello', 'roar'), of('world'), of('test'))

            expect(test_).to.produce('hello', 'roar', 'world', 'test')
        end)

        it('handles double nested observables properly', function()
            local firstThree_ = from({'one', 'two', 'three'})
            local secondThree_ = from({'four', 'five', 'six'})
            local onlyFirst_ = merge(firstThree_)
            local both_ = merge(onlyFirst_, secondThree_)
            local test_ = merge(both_, firstThree_)

            expect(test_).to.produce('one', 'two', 'three', 'four', 'five', 'six', 'one', 'two', 'three')
        end)
    end)
end)
