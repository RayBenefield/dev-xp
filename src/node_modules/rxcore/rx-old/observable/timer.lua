local create = require('rx.observable.create')

return function(delay, interval)
    return create(function(subscriber)
        local cancelled = false
        local task = Task.Spawn(function()
            local number = 0

            Task.Wait(delay / 1000)
            subscriber.next(number)

            if (interval) then
                while (not cancelled) do
                    number = number + 1
                    Task.Wait(interval / 1000)

                    if (number >= 4) then
                        cancelled = true
                    end

                    subscriber.next(number)
                end
                return
            end

            subscriber.complete()
        end)

        return function()
            cancelled = true
            Task.Cancel(task)
        end
    end)
end
