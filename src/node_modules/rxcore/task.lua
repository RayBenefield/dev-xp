function spawn(fn)
    if type(fn) == "function" then
        local taskRoutine
        taskRoutine = coroutine.create(function()
            fn({
                Wait = function(timeout)
                    local waitDone = false
                    local sleep = coroutine.create(function()
                        local startSleep = os.clock()
                        local elapsedSleep = 0
                        local sleepDone = false

                        while sleepDone == false do
                            elapsedSleep = (os.clock() - startSleep) * 100000
                            os.execute("sleep 0.01")
                            if (elapsedSleep > timeout) then
                                sleepDone = true
                                waitDone = true
                            end
                            coroutine.yield()
                        end
                    end)
                    while waitDone == false do
                        coroutine.resume(sleep)
                        if (waitDone) then
                            coroutine.resume(taskRoutine)
                        end
                    end
                end,
            })
        end)
        coroutine.resume(taskRoutine)
    end
end

return { Spawn = spawn }
