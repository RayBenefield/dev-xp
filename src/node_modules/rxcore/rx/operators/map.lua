local create = require('rx.observable.create')

return function(projection)
    local operator = function(source)
        return create(function(destination)
            source.subscribe(
                function(...)
                    destination.next(projection(...))
                end,
                destination.error,
                destination.complete
            )
            return function()
                destination.complete()
            end
        end)
    end

    return operator
end
