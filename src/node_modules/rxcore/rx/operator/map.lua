local operate = require('rx.operator')
local observer = require('rx.observer')

--TODO
-- Handle an index for every time the map is executed
return function(projection)
    return operate(function(source, destination)
        source.subscribe(
            observer(
                destination,
                function(...)
                    if (projection) then
                        destination.next(projection(...))
                    else
                        destination.next(...)
                    end
                end
            )
        )
    end)
end
