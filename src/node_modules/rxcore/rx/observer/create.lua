local util = require('util')
local createSubscription = require('rx.subscription.create')

return function(next, err, complete)
    next = next or util.noop
    err = err or util.printError
    complete = complete or util.noop

    local stopped = false
    local subscription = createSubscription()

    local observer = {
        next = function(...)
            if (not stopped) then
                next(...)
            end
        end,
        err = function(...)
            if (not stopped) then
                stopped = true
                err(...)
                subscription.unsubscribe()
            end
        end,
        complete = function()
            if (not stopped) then
                stopped = true
                complete()
                subscription.unsubscribe()
            end
        end,
        add = subscription.add,
        unsubscribe = subscription.unsubscribe,
    }

    return observer
end
