local util = require('util')
local createObserver = require('rx.observer.create')

local isObserver = util.isObserver

local create

create = function(subscribe)
    local observable

    local subscribe = function(observerOrNext, err, complete)
        local destination

        if (isObserver(observerOrNext)) then
            destination = observerOrNext
        else
            destination = createObserver(observerOrNext, err, complete)
        end

        destination.add(subscribe(destination))

        return destination
    end

    local lift = function(operator)
        local this = observable
        local operator = operator

        return create(function(destination)
            return this.subscribe(operator(destination))
        end)
    end

    local pipe = function(...)
        local this = observable

        return this
    end

    observable = { subscribe = subscribe, lift = lift, pipe = pipe }

    return observable
end

return create
