import { of } from 'rxjs'
import { filter, map, share } from 'rxjs/operators'

export default ({ db }) => source => {
    const { type, name } = source
    if (type === 'db')
        return (
            db
                // TODO: Replace `testing` with Project ID
                .onDocumentChange(`projects/testing/custom-db/${name}`)
                .pipe(
                    filter(_ => _),
                    map(params => ({ params, source })),
                    share()
                )
        )

    return of({ source: { type: 'blank' } }).pipe(share())
}
