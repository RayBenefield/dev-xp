/* eslint-disable no-console */
import { start, firebase } from '@rampant/ai'
import { white, underline } from 'chalk'
import serial from '@rampant/serial-promise'
import { testCount, intents, cleanupDocs } from '@rampant/ai/test-intents.js'

start()
const { db } = firebase

const createIntents = () => {
    console.log()
    console.log(`  ${white(underline('Intent Tests'))}`)
    console.log()

    return Promise.all(
        intents.map(intent =>
            db.set(`projects/testing/intents/${intent.name}`, intent)
        )
    )
}

const cleanup = () => {
    console.log()
    console.log(white.bold(`    ${testCount} tests run`))
    console.log()

    return Promise.all([
        ...intents.map(({ name }) =>
            db.remove(`projects/testing/intents/${name}`)
        ),
        ...cleanupDocs.map(doc =>
            db.remove(`projects/testing/custom-db/${doc}`)
        ),
    ])
}

serial([createIntents, cleanup], 2000).then(() => process.exit(0))
