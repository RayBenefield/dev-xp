/* eslint-disable import/no-dynamic-require */
import argv from 'argv'
import { start, db } from '@rampant/ai'

argv.version('v0.0.0')
argv.info('Create and run a Rampant AI project directly.')

argv.option([
    {
        name: 'path',
        short: 'p',
        type: 'path',
        description:
            'Where the intents.js and sources.js files exist to load for the project',
        example: '--path=/path/to/folder',
    },
    {
        name: 'name',
        short: 'n',
        type: 'string',
        description: 'Name of project to save intents/sources under',
        example: '--name=channel-name',
    },
])

const { options: { path, name } } = argv.run()
process.env.PROJECT_ID = name

const sources = require(`${path}/sources.js`)
const intents = require(`${path}/intents.js`)

Promise.all([
    db.set(`projects/${name}`, { sources }),
    ...intents.map(intent =>
        db.set(`projects/${name}/intents/${intent.name}`, intent)
    ),
]).then(() => start({ projectId: name }))
