import createDb from '@rampant/db'
import { tap, map } from 'rxjs/operators'
import createIntentEngine from '@rampant/engine'

const intentEngine = createIntentEngine()
const db = createDb('rampant-ai')

db
    .onCollectionChange('projects/testing/intents')
    .pipe(
        map(change => ({
            id: change.doc.id,
            type: change.type,
            new: change.doc.data(),
        })),
        tap(({ id, type, new: newValue }) => {
            if (type === 'added') intentEngine.addIntent(id, newValue)
        })
    )
    // eslint-disable-next-line no-console
    .subscribe(console.log)
