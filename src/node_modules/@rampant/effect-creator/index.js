import get from '@rampant/get'
import { tap } from 'rxjs/operators'

export default ({ db, mixerChat }) => {
    const effectTypes = {
        log: ({ message }) =>
            tap(({ context }) =>
                // eslint-disable-next-line no-console
                console.log(get({ $: context }, message))
            ),
        db: ({ action = 'upsert', doc, data }) =>
            tap(({ context }) => {
                const key = get({ $: context }, doc)
                const value = get({ $: context }, data)

                db[action](`projects/testing/custom-db/${key}`, value)
            }),
        message: ({ text, userId, channelId }) =>
            tap(() => {
                mixerChat({ channelId, userId }).then(chat =>
                    chat.message(text)
                )
            }),
        empty: tap(() => {}),
    }

    return effect => {
        const { type = 'empty' } = effect
        const effectCreator = effectTypes[type]
        return effectCreator(effect)
    }
}
