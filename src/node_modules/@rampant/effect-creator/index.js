import get from '@rampant/get'
import { tap } from 'rxjs/operators'

export default ({ plugins }) => {
    const pluginEffects = Object.values(plugins).reduce(
        (all, { effects }) => ({
            ...all,
            ...effects,
        }),
        {}
    )

    const effectTypes = {
        ...pluginEffects,
        log: ({ message }) =>
            tap(payload =>
                // eslint-disable-next-line no-console
                console.log(get({ $: payload }, message))
            ),
        empty: tap(() => {}),
    }

    return effect => {
        const { type = 'empty' } = effect
        const effectCreator = effectTypes[type]
        return effectCreator(effect)
    }
}
