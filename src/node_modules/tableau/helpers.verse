
using. /Verse.org/Simulation
using. /Fortnite.com/Devices
using. /UnrealEngine.com/Temporary/UI
using. /UnrealEngine.com/Temporary/SpatialMath

using. Numb
using. Vertex

(GameState:game_state).OnUpdated<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_()<suspends>:void})<suspends>:void=
    PropType := GameState.GetPropType(ResourceID, PropertyID)
    return case(PropType):
        prop_type.Num =>
            Prop := GameState.GetNumProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Str =>
            Prop := GameState.GetStrProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Strs =>
            Prop := GameState.GetStrsProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Bool =>
            Prop := GameState.GetBoolProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Float =>
            Prop := GameState.GetFloatProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Agent =>
            Prop := GameState.GetAgentProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Vec2 =>
            Prop := GameState.GetVec2Prop(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Vec3 =>
            Prop := GameState.GetVec3Prop(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Integer =>
            Prop := GameState.GetIntProp(ResourceID, PropertyID, PlayerID)
            loop:
                Value := Prop.UpdatedEvent().Await()
                spawn. Tap()
        prop_type.Unknown => {}

(GameState:game_state).SyncBool<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:logic)<suspends>:void})<suspends>:void=
    Prop := GameState.GetBoolProp(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncFloat<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:float)<suspends>:void})<suspends>:void=
    Prop := GameState.GetFloatProp(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncNum<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:num)<suspends>:void})<suspends>:void=
    Prop := GameState.GetNumProp(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncStr<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:string)<suspends>:void})<suspends>:void=
    Prop := GameState.GetStrProp(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncInt<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:int)<suspends>:void})<suspends>:void=
    Prop := GameState.GetIntProp(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncAgent<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:?agent)<suspends>:void})<suspends>:void=
    Prop := GameState.GetAgentProp(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncVec2<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:vector2)<suspends>:void})<suspends>:void=
    Prop := GameState.GetVec2Prop(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

(GameState:game_state).SyncVec3<public>(ResourceID:string, PropertyID:string, PlayerID:string, Tap:type{_(:vector3)<suspends>:void})<suspends>:void=
    Prop := GameState.GetVec3Prop(ResourceID, PropertyID, PlayerID)
    Tap(Prop.Get())
    loop:
        Value := Prop.UpdatedEvent().Await()
        spawn. Tap(Value)

# TODO: Using Get() and calling twice in a row creates a lock
(GameState:game_state).SpawnProp<public>(Asset:creative_prop_asset, ResourceID:string, Location:half_path)<suspends>:?creative_prop=
    Loc := GameState.GetVec3Prop(ResourceID, Location, "").Get()
    SpawnProp(Asset, Loc, IdentityRotation())(0)

(GameState:game_state).AddUI<public>(Widget:widget, PlayerID:string, Settings:canvas_settings)<suspends>:?widget=
    CanvasSlot := MakeWidget(Widget, Settings)
    Canvas := if (Settings.Interactive?). GameState.GetInteractiveCanvas(PlayerID) else. GameState.GetCanvas(PlayerID)
    if (C := Canvas?):
        C.AddWidget(CanvasSlot)
        return option. Widget

    return false
