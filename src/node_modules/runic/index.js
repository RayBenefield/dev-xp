import * as _ from '@dev-xp/utils'
import number from '@sigils/number'
import { Input, Output } from 'rete'
import sockets from '@sigils/sockets'

const createIO = (obj, io) =>
    _.mapObjIndexed(
        (socket, type) => name => ({
            name: type,
            type: io,
            create: (altar, key) =>
                _.constructN(3, obj)(key.toString(), name.toString(), socket),
        }),
        sockets
    )

export const input = createIO(Input, 'input')
export const output = createIO(Output, 'output')

export const getType = _.cond([
    [_.isNumber, _.always('number')],
    [_.isFunction, _.always('function')],
    [_.T, _.always('any')],
])

export const createOutput = (value, name) => output[getType(value)](name)
export const createInput = (value, name) => input[getType(value)](name)

export { default as altar } from '@sigils/altar'
export const runes = { number }
