import render from '@kikd/render';
import transmute from 'transmutation';
import findPackages from '@kikd/find-packages';
import findRepoRoot from '@kikd/find-repo-root';
import buildRollupConfigs from '@kikd/build-rollup-configs';
import buildPackages from '@kikd/build-packages';
import formatPackageList from '@kikd/format-package-list';

export default {
    ls: () =>
        transmute({})
            .extend('root', findRepoRoot)
            .extend('ignore', ['__tests__'])
            .extend('packages', findPackages)
            .extend('template', formatPackageList)
            .extend('output', render)
            .then(({ output }) => console.log(output)),
    b: () =>
        findRepoRoot()
            .then(root => findPackages({ root, ignore: ['__tests__'] }))
            .then(packages => packages.filter(p => p.bin))
            .then(packages =>
                findRepoRoot().then(root =>
                    buildRollupConfigs({ root, packages }),
                ),
            )
            .then(buildPackages),
};
