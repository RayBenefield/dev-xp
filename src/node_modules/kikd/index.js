import RenderKid from 'renderkid';
import style from '@kikd/cli-style';
import findPackages from '@kikd/find-packages';
import findRepoRoot from '@kikd/find-repo-root';
import buildRollupConfigs from '@kikd/build-rollup-configs';
import buildPackages from '@kikd/build-packages';
import formatPackageList from '@kikd/format-package-list';

const renderer = new RenderKid();
renderer.style(style);

export default {
    ls: () =>
        findRepoRoot()
            .then(root => findPackages({ root, ignore: ['__tests__'] }))
            .then(formatPackageList)
            .then(packageList => renderer.render(packageList))
            .then(console.log),
    b: () =>
        findRepoRoot()
            .then(root => findPackages({ root, ignore: ['__tests__'] }))
            .then(packages => packages.filter(p => p.bin))
            .then(packages =>
                findRepoRoot().then(root =>
                    buildRollupConfigs({ root, packages }),
                ),
            )
            .then(buildPackages),
};
