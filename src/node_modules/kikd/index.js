import render from '@kikd/render';
import transmute from 'transmutation';
import findPackages from '@kikd/find-packages';
import findRepoRoot from '@kikd/find-repo-root';
import buildPackages from '@kikd/build-packages';
import findBaseConfig from '@kikd/find-base-config';
import formatPackageList from '@kikd/format-package-list';
import buildRollupConfigs from '@kikd/build-rollup-configs';

export default {
    ls: () =>
        transmute({})
            .extend('root', findRepoRoot)
            .extend('ignore', ['__tests__'])
            .extend('packages', findPackages)
            .extend('template', formatPackageList)
            .extend('output', render)
            .then(({ output }) => console.log(output)),
    b: () =>
        transmute({})
            .extend('root', findRepoRoot)
            .extend('baseConfig', findBaseConfig)
            .extend('ignore', ['__tests__'])
            .extend('unfiltered', findPackages)
            .extend('packages', ({ unfiltered }) =>
                unfiltered.filter(p => p.bin),
            )
            .extend('configs', buildRollupConfigs)
            .then(buildPackages),
};
