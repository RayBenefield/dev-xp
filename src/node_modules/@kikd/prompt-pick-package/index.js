import { filter } from 'fuzzy'
import find from 'lodash.find'
import inquirer from 'inquirer'
import autocomplete from 'inquirer-autocomplete-prompt'

inquirer.registerPrompt('autocomplete', autocomplete)

const searchPackages = packages => (answers, input = '') =>
    new Promise(res => {
        setTimeout(
            () =>
                res(
                    filter(input, packages, { extract: pkg => pkg.name }).map(
                        result => result.original || result
                    )
                ),
            500
        )
    })

export default ({ message = 'Which package should we pick?', packages }) =>
    inquirer
        .prompt([
            {
                type: 'autocomplete',
                name: 'name',
                message,
                source: searchPackages(packages),
            },
        ])
        .then(({ name }) => find(packages, { name }))
