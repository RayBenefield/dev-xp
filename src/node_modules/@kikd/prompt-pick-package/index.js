import { filter } from 'fuzzy'
import inquirer from 'inquirer'
import autocomplete from 'inquirer-autocomplete-prompt'

inquirer.registerPrompt('autocomplete', autocomplete)

const searchPackages = packageNames => (answers, input = '') =>
    new Promise(res => {
        setTimeout(
            () =>
                res(
                    filter(input, packageNames).map(
                        result => result.original || result
                    )
                ),
            500
        )
    })

export default ({ message = 'Which package should we pick?', packageNames }) =>
    inquirer
        .prompt([
            {
                type: 'autocomplete',
                name: 'name',
                message,
                source: searchPackages(packageNames),
            },
        ])
        .then(({ name }) => name)
