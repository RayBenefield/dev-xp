import { join } from 'path'

import dedent from 'dedent'
import { prompt } from 'inquirer'
import { write, mkdir } from '@dev-xp/fs'

export const preCreate = ({ name, packagePath }) =>
    prompt([
        {
            type: 'editor',
            name: 'indexContents',
            message: 'What should the initial contents be for the index be?',
            default: dedent`
                import log from '@dev-xp/log'

                export default () => log('${name}')
            `,
        },
    ]).then(({ indexContents }) => ({
        indexPath: join(packagePath, 'index.js'),
        indexContents,
    }))

export const createTemplate = ({ indexPath }) => `
    <attr><key>Index Path:</key><value>${indexPath}</value></attr>
`

export default ({
    packagePath,
    extra: { indexPath, indexContents } = {},
} = {}) => {
    mkdir(packagePath)
    write(indexPath, indexContents)
}
