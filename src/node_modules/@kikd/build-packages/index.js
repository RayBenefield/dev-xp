import rimraf from 'rimraf'
import { resolve } from 'path'
import promisify from 'es6-promisify'

const removeDir = promisify(rimraf)

export default plugins => ({ root, baseConfig, configs = [] } = {}) =>
    removeDir(resolve(root, 'dist')).then(() =>
        Promise.all(
            configs.map(config =>
                plugins[config.type].build({ root, config }).then(() =>
                    plugins[config.type].postBuild({
                        root,
                        baseConfig,
                        config: config.post,
                    })
                )
            )
        )
    )
