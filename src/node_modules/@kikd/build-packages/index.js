import rimraf from 'rimraf';
import { resolve } from 'path';
import { rollup } from 'rollup';
import { promisify } from 'util';

const removeDir = promisify(rimraf);

export default ({ root, configs = [] } = {}) =>
    removeDir(resolve(root, 'dist')).then(
        Promise.all(
            configs.map(config =>
                rollup({
                    input: config.input,
                    external: config.external,
                    plugins: config.plugins,
                }).then(bundle =>
                    Promise.all(
                        config.output.map(out =>
                            bundle.write({
                                file: out.file,
                                format: out.format,
                                banner: config.banner,
                            }),
                        ),
                    ),
                ),
            ),
        ),
    );
