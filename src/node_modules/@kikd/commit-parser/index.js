/* eslint-disable indent */
const regex = /^([^A-Z]*)\(((?:[^A-Z*]*)|\*)\): ([^a-z].*\.)$/;

export default ({ commits = [] } = {}) =>
    Array.prototype.concat(
        ...commits.map(commit => commit.split(/\r?\n/)).map(lines =>
            lines
                .map(line => ({
                    body: line,
                    matches: line.match(regex) || [],
                }))
                .map(
                    ({ body, matches: [, type, scopes, subject] }) =>
                        type
                            ? {
                                  type,
                                  scopes: scopes.split(',').map(s => s.trim()),
                                  subject,
                              }
                            : { body },
                )
                .reduce((combined, line) => {
                    if (combined.body && line.body) {
                        return {
                            ...combined,
                            body: [combined.body, line.body].join('\n'),
                        };
                    }
                    return {
                        ...combined,
                        ...line,
                    };
                }, {}),
        ),
    );
