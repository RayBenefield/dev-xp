import { isolate } from 'transmutation';

import checkedPackages from '@kikd/command-check';
import recommendVersions from '@kikd/recommend-version';

export default () =>
    checkedPackages()
        .extend('filtered', ({ packages, checks }) =>
            packages
                .filter(pkg => pkg.version)
                .filter(pkg => checks.packages[pkg.name].publishable),
        )
        .extend('updates', ({ filtered: packages }) =>
            recommendVersions({ packages }),
        )
        .then(isolate('updates'));
