import { resolve } from 'path'

import describe from 'kape'
import detect from '@kikd/dependency-detective'

const locals = [
    'no-config',
    'kikd',
    '@kikd/first',
    '@kikd/second',
    '@kikd/third',
]
const structures = {
    'no-config': {
        srcDir: './src/node_modules/no-config',
        files: ['index.js'],
    },
    kikd: {
        srcDir: './src/node_modules/kikd',
        files: ['cli.js', 'package.json'],
    },
    '@kikd/first': {
        srcDir: './src/node_modules/@kikd/first',
        files: ['index.js', 'package.json'],
    },
    '@kikd/second': {
        srcDir: './src/node_modules/@kikd/second',
        files: ['index.js', 'package.json'],
    },
    '@kikd/third': {
        srcDir: './src/node_modules/@kikd/third',
        files: ['source.js', 'package.json'],
    },
}
const manifests = {
    'no-config': {},
    kikd: {
        bin: {
            kd: 'cli.js',
        },
    },
    '@kikd/first': {},
    '@kikd/second': {},
    '@kikd/third': {
        main: 'source.js',
    },
}

describe(
    'Dependency Detective',
    detect({
        root: resolve(__dirname, 'fixtures'),
        locals,
        structures,
        manifests,
    }),
    snapshot =>
        snapshot(
            [],
            ['no-config'],
            ['kikd'],
            ['@kikd/first'],
            ['@kikd/second'],
            ['@kikd/third']
        )
)
