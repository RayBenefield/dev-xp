import describe from 'kape'
import { resolve } from 'path'
import detect from '@kikd/dependency-detective'

const packages = {
    'no-config': {
        name: 'no-config',
        files: ['index.js'],
    },
    kikd: {
        name: 'kikd',
        files: ['cli.js', 'package.json'],
        bin: {
            kd: 'cli.js',
        },
    },
    '@kikd/first': {
        name: '@kikd/first',
        files: ['index.js', 'package.json'],
    },
    '@kikd/second': {
        name: '@kikd/second',
        files: ['index.js', 'package.json'],
    },
    '@kikd/third': {
        name: '@kikd/third',
        main: 'source.js',
        files: ['source.js', 'package.json'],
    },
}

describe(
    'Dependency Detective',
    detect({
        root: resolve(__dirname, 'fixtures/src/node_modules'),
        packages,
    }),
    snapshot =>
        snapshot(
            [],
            [packages['no-config']],
            [packages.kikd],
            [packages['@kikd/first']],
            [packages['@kikd/second']],
            [packages['@kikd/third']]
        )
)
