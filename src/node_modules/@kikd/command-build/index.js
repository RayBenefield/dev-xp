import transmute from 'transmutation';

import findPackages from '@kikd/find-packages';
import findRepoRoot from '@kikd/find-repo-root';
import buildPackages from '@kikd/build-packages';
import findBaseConfig from '@kikd/find-base-config';
import buildRollupConfigs from '@kikd/build-rollup-configs';

export default () =>
    transmute({})
        .extend('root', findRepoRoot)
        .extend('baseConfig', findBaseConfig)
        .extend('exclude', ['**/fixtures/**'])
        .extend('unfiltered', findPackages)
        .extend('packages', ({ unfiltered }) => unfiltered.filter(p => p.bin))
        .extend('configs', buildRollupConfigs)
        .then(buildPackages);
