import { isolate } from 'transmutation';
import buildPackages from '@kikd/build-packages';
import getDependencies from '@kikd/command-deps';
import getPublishablePackages from '@kikd/command-publish';
import buildRollupConfigs from '@kikd/build-rollup-configs';

export default function build(...args) {
    return getPublishablePackages(...args)
        .extend(
            'dependencies',
            getDependencies(...args).then(isolate('dependencies')),
        )
        .extend('configs', snowball =>
            buildRollupConfigs({ ...snowball, packages: snowball.publishable }),
        );
}

export const command = {
    name: 'build',
    renderer: () => {},
    run: build,
    effect: buildPackages,
};
