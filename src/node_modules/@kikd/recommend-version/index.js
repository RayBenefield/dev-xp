import { lt as lessThan, inc } from 'semver';

export default ({ packages = [] } = {}) => {
    if (packages.length <= 0) return [];
    const results = packages.filter(pkg => pkg.name).map(pkg => {
        if (!pkg.version) {
            return {
                [pkg.name]: {
                    type: 'new',
                    old: null,
                    new: '0.0.1',
                },
            };
        }

        if (lessThan(pkg.version, '0.1.0')) {
            return {
                [pkg.name]: {
                    type: 'patch',
                    old: pkg.version,
                    new: inc(pkg.version, 'patch'),
                },
            };
        }

        return {
            [pkg.name]: {
                type: 'none',
                old: pkg.version,
                new: pkg.version,
            },
        };
    });
    return results;
};
