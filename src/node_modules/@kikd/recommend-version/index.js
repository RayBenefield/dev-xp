import { lt as lessThan, inc } from 'semver';

import collapsePackages from '@kikd/collapse';

// eslint-disable-next-line no-unused-vars
export default ({ publishable = [], packages = [], changes = [] } = {}) => {
    if (!publishable || publishable.length <= 0) return {};
    return publishable
        .filter(pkg => pkg.name)
        .map(pkg => {
            if (!pkg.version) return undefined;
            if (pkg.version === '0.0.0') {
                return {
                    [pkg.name]: {
                        type: 'patch',
                        old: pkg.version,
                        new: '0.0.1',
                        reason: 'Prereleased',
                    },
                };
            }

            if (lessThan(pkg.version, '0.1.0')) {
                return {
                    [pkg.name]: {
                        type: 'patch',
                        old: pkg.version,
                        new: inc(pkg.version, 'patch'),
                        reason: 'In Development',
                    },
                };
            }

            return undefined;
        })
        .filter(pkg => pkg)
        .reduce(collapsePackages, {});
};
