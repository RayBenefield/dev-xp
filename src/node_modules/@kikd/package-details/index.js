import collapse from '@kikd/collapse'

export default ({ plugins }) => ({
    root = '.',
    packageNames = [],
    types = {},
    structures = {},
}) =>
    Promise.all(
        packageNames.map(
            async name =>
                types[name] !== 'unknown'
                    ? /* eslint-disable indent */
                      {
                          [name]:
                              (await plugins[types[name]].manifest({
                                  root,
                                  structure: structures[name],
                                  name,
                              })) || {},
                      }
                    : { [name]: {} }
        )
    ).then(manifests => manifests.reduce(collapse, {}))
