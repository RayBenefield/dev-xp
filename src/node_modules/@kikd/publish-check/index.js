import checkPackage from '@kikd/check-package';

export default ({ root, packages = [] } = {}) =>
    new Promise(async res => {
        if (packages.length === 0) return res([]);
        const packageChecks = await Promise.all(
            packages.map(pkg => checkPackage(pkg, root)),
        );
        return res({
            root: {},
            packages: packageChecks.reduce((all, curr) => {
                if (curr.undefined) {
                    const und = all.undefined
                        ? [...all.undefined, curr.undefined]
                        : [curr.undefined];
                    return {
                        ...all,
                        undefined: und,
                    };
                }
                return Object.assign(all, curr);
            }, {}),
        });
    });
