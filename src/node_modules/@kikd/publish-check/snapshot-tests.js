import { resolve } from 'path';
import describe from 'kape';
import publishCheck from '@kikd/publish-check';

process.chdir(resolve(__dirname, 'fixtures'));
const packages = dir => ({
    root: '.',
    packages: [
        {
            dir,
            // eslint-disable-next-line global-require, import/no-dynamic-require
            ...require(resolve(__dirname, `fixtures/${dir}/package.json`)),
        },
    ],
});

describe('Publish Check', publishCheck, it => {
    it('should capture results', given =>
        given([
            [],
            [{ packages: [] }],
            [
                {
                    root: '.',
                    packages: [
                        {
                            dir: 'empty-dir',
                        },
                    ],
                },
            ],
            [packages('module-empty-package-json')],
            [packages('no-main')],
            [packages('main-app-js')],
            [packages('main-app-js-readme')],
            [packages('main-index-js-readme')],
            [packages('bin-cli-js')],
            [packages('bin-cli-js-readme')],
            [packages('main-app-js-bin-cli-js')],
            [packages('main-app-js-bin-cli-js-readme')],
            [packages('main-app-js-wrong-bin-readme')],
            [packages('wrong-main-bin-cli-js-readme')],
            [packages('multiple-bins-readme')],
            [packages('multiple-bins-wrong-main-readme')],
            [packages('multiple-bins-one-wrong-readme')],
        ]));
});
