/* eslint-disable global-require, import/no-dynamic-require */
import { readdirSync } from 'fs'
import { resolve } from 'path'

import describe from 'kape'
import publishCheck from '@kikd/publish-check'

describe('Publish Check', publishCheck, snapshot => {
    process.chdir(resolve(__dirname, 'fixtures'))
    const repo = dir => {
        const modules = readdirSync(resolve(__dirname, 'fixtures', dir)).filter(
            f => f !== 'LICENSE' && f !== 'package.json'
        )
        return {
            root: dir,
            baseConfig: require(resolve(
                __dirname,
                `fixtures/${dir}/package.json`
            )),
            packages: modules.map(mod => ({
                dir,
                ...require(resolve(
                    __dirname,
                    `fixtures/${dir}/${mod}/package.json`
                )),
            })),
        }
    }

    snapshot(
        [],
        [repo('no-license')],
        [repo('has-license')],
        [repo('has-license-with-props')]
    )
})
