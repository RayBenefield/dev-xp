/* eslint-disable global-require, import/no-dynamic-require */
import { readdirSync } from 'fs';
import { resolve } from 'path';
import describe from 'kape';
import publishCheck from '@kikd/publish-check';

process.chdir(resolve(__dirname, 'fixtures'));
const repo = dir => {
    const modules = readdirSync(resolve(__dirname, 'fixtures', dir)).filter(
        f => f !== 'LICENSE' && f !== 'package.json',
    );
    return {
        root: dir,
        baseConfig: require(resolve(__dirname, `fixtures/${dir}/package.json`)),
        packages: modules.map(mod => ({
            dir,
            ...require(resolve(
                __dirname,
                `fixtures/${dir}/${mod}/package.json`,
            )),
        })),
    };
};

describe('Publish Check', publishCheck, it => {
    it('should capture results', given =>
        given([
            [],
            [repo('no-license')],
            [repo('has-license')],
            [repo('has-license-with-props')],
        ]));
});
