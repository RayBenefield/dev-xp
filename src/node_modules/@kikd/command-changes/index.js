import transmute from 'transmutation';
import parseTags from '@kikd/parse-tags';
import gatherTags from '@kikd/tag-gatherer';
import gatherChanges from '@kikd/change-gatherer';
import changesTemplate from '@kikd/template-changes';
import latestReleaseTag from '@kikd/latest-release-tag';

export default function changes() {
    return transmute({})
        .extend('rawTags', gatherTags)
        .extend('tags', parseTags)
        .extend('latest', latestReleaseTag)
        .extend('from', ({ latest }) => latest.tag)
        .extend('changes', gatherChanges);
}

export const command = {
    name: 'changes',
    aliases: ['changelog'],
    template: changesTemplate,
    run: changes,
};
