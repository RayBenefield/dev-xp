import { resolve } from 'path';
import describe from 'kape';
import checkPackages from '@kikd/check-packages';

const packages = dir => ({
    packages: [
        {
            dir: resolve(__dirname, `fixtures/${dir}`),
            // eslint-disable-next-line global-require, import/no-dynamic-require
            ...require(resolve(__dirname, `fixtures/${dir}/package.json`)),
        },
    ],
});

describe('Check Packages', checkPackages, it => {
    it('should capture results', given =>
        given([
            [],
            [{ packages: [] }],
            [
                {
                    packages: [
                        {
                            dir: resolve(__dirname, 'fixtures/empty-dir'),
                        },
                    ],
                },
            ],
            [packages('module-empty-package-json')],
            [packages('no-main')],
            [packages('main-app-js')],
            [packages('main-app-js-readme')],
            [packages('main-index-js-readme')],
            [packages('bin-cli-js')],
            [packages('bin-cli-js-readme')],
        ]));
});
