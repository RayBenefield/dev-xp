import { resolve } from 'path';
import describe from 'kape';
import checkPackages from '@kikd/check-packages';

process.chdir(__dirname);
const packages = dir => ({
    root: '.',
    packages: [
        {
            dir: `fixtures/${dir}`,
            // eslint-disable-next-line global-require, import/no-dynamic-require
            ...require(resolve(__dirname, `fixtures/${dir}/package.json`)),
        },
    ],
});

describe('Check Packages', checkPackages, it => {
    it('should capture results', given =>
        given([
            [],
            [{ packages: [] }],
            [
                {
                    root: '.',
                    packages: [
                        {
                            dir: 'fixtures/empty-dir',
                        },
                    ],
                },
            ],
            [packages('module-empty-package-json')],
            [packages('no-main')],
            [packages('main-app-js')],
            [packages('main-app-js-readme')],
            [packages('main-index-js-readme')],
            [packages('bin-cli-js')],
            [packages('bin-cli-js-readme')],
        ]));
});
