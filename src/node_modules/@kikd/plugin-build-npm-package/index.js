import { input, output, postInfo, plugins } from '@kikd/rollup-utils'
import build from '@kikd/build-rollup'
import postBuild from '@kikd/post-build'

const type = 'npm-package'
export default {
    type,
    filter: pkg => !pkg.bin && (pkg.main || pkg.files.includes('index.js')),
    config: ({ baseConfig, dependencies }) => p => {
        const pkg = { ...p, file: p.main || 'index.js' }
        return {
            type,
            in: input({ pkg, dependencies, plugins: plugins() }),
            out: [output({ pkg, format: 'cjs' })],
            post: postInfo({ pkg, baseConfig, dependencies }),
        }
    },
    build,
    postBuild,
}
