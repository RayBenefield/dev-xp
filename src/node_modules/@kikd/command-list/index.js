import transmute from 'transmutation'

import findRepoRoot from '@kikd/find-repo-root'
import template from '@kikd/template-package-list'
import findBaseConfig from '@kikd/find-base-config'
import getPackageDetails from '@kikd/package-details'
import filterPackages from '@kikd/filter-packages'

export default function list(config) {
    return transmute({})
        .extend('root', findRepoRoot)
        .extend('baseConfig', findBaseConfig)
        .extend('exclude', ['**/fixtures/**'])
        .extend('packageNames', filterPackages(config))
        .extend('packages', getPackageDetails)
}

export const command = () => ({
    name: 'list',
    aliases: ['ls'],
    run: list,
    template,
    args: {
        _: 'packageNames',
        publishable: 'onlyPublishable',
        changed: 'onlyChanged',
        releasing: 'changedAndPublishable',
    },
})
