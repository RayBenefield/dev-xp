/* eslint-disable no-console */
import execa from 'execa';
import npm from 'npm-utils';
import { resolve } from 'path';
import registryUrl from 'registry-url';

export default ({ root, publishable }) => {
    process.chdir(root);
    return npm.setAuthToken().then(() =>
        Promise.all(
            publishable.map(({ name }) => {
                process.chdir(resolve(root, 'dist', name));
                console.log(`Publishing [${name}]...`);
                return execa('npm', ['publish', '--registry', registryUrl()])
                    .then(result => console.log(result.stdout))
                    .catch(console.log);
            }),
        ),
    );
};
