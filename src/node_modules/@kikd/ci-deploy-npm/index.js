import npm from 'npm-utils';
import { resolve } from 'path';

export default ({ root, packages }) => {
    const { NPM_TOKEN } = process.env;

    if (!NPM_TOKEN) throw new Error('The NPM_TOKEN env variable must be set!');

    process.chdir(root);
    return npm.setAuthToken().then(() =>
        Promise.all(
            packages.map(pkg => {
                process.chdir(resolve(root, 'dist', pkg.name));
                console.log(`Publishing ${pkg.name}...`);
                return npm.publish();
            }),
        ),
    );
};
