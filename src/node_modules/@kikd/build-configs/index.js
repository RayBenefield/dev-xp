import * as _ from '@dev-xp/utils'
import { NOFN } from '@dev-xp/noop'

export default ({ plug = NOFN }) => ({
    packageNames = [],
    rootManifest,
    dependencies,
    structures,
    manifests,
    types,
} = {}) =>
    Promise.all(
        _.map(name => {
            const promise = plug('config')({
                type: types[name],
                rootManifest,
                dependencies: dependencies[name],
                structure: structures[name],
                manifest: manifests[name],
            })
            return Promise.resolve(promise).then(config => ({
                [name]: config,
            }))
        }, packageNames)
    ).then(_.mergeAll)
