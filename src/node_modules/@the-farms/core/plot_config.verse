
using. /Fortnite.com/Devices
using. /Verse.org/Simulation

using. Numb
using. Tableau
using. TableauResource

plot_config<public> := class(creative_device, config_device):
    GetResources<override>():[]resource= array:
        resource:
            Type := "Plot"
            Props := map:
                "ZERO" => prop_float. Default := 0.0
                "ONE" => prop_float. Default := 1.0
                "EMPTY" => prop_str. Default := ""
                "TRUE" => prop_bool. Default := true
                "FALSE" => prop_bool. Default := false
                "Stage" => prop_int{}
                "Max Stage" => prop_int. Default := 4
                "Plant Type" => prop_str{}
                "Exists" => prop_bool. Default := true
                "Watered" => prop_bool. Default := false
                "Watered Count" => prop_num{}
                "Growth Time" => prop_float. Default := 5.0
                "X" => prop_int{}
                "Y" => prop_int{}
                "X Coord" => prop_float{ Focus := Path("X"), FN := "*", Tweak := Path("Farmer", "Grid Size") }
                "Y Coord" => prop_float{ Focus := Path("Y"), FN := "*", Tweak := Path("Farmer", "Grid Size") }
                "Next Stage" => prop_int{ Focus := Path("Stage"), FN := "+", Tweak := Path("ONE") }
                "Has Plant" => prop_bool{ Focus := Path("Plant Type"), FN := "Not Empty" }
                "Is Seed" => prop_bool{ Focus := Path("Stage"), FN := "=", Tweak := Path("ZERO") }
                "Is Plant" => prop_bool{ FN := "NOT", Focus := Path("Is Seed") }
                "Not Watered" => prop_bool{ FN := "NOT", Focus := Path("Watered") }
                "Not Watered Plant" => prop_bool{ Focus := Path("Not Watered"), FN := "AND", Tweak := Path("Has Plant") }
                "Can Plant" => prop_bool{ FN := "NOT", Focus := Path("Has Plant") }
                "Can Water" => prop_bool{ Focus := Path("Not Watered Plant"), FN := "AND", Tweak := Path("Not Done") }
                "Can Harvest" => prop_bool{ Focus := Path("Stage"), FN := "=", Tweak := Path("Max Stage") }
                "Not Done" => prop_bool{ FN := "NOT", Focus := Path("Can Harvest") }
                "XY Location" => prop_vec2{ Focus := Path("X Coord"), FN := "Append", Tweak := Path("Y Coord") }
                "Location" => prop_vec3{ Focus := Path("XY Location"), FN := "Append", Tweak := Path("ZERO") }
            Abilities := map:
                "Plant" => array:
                    effect{ FN := "Is True", Focus := Path("Can Plant") }
                    effect{ FN := "Set", Focus := Path("Plant Type"), Tweak := Path("Farmer", "Plant") }
                "Water" => array:
                    effect{ FN := "Is True", Focus := Path("Can Water") }
                    effect{ FN := "Set", Focus := Path("Watered"), Tweak := Path("TRUE") }
                    effect{ FN := "Increase", Focus := Path("Watered Count"), Tweak := Path("ONE") }
                    effect{ FN := "Delay", Focus := Path("Growth Time") }
                    effect{ FN := "Set", Focus := Path("Stage"), Tweak := Path("Next Stage") }
                    effect{ FN := "Set", Focus := Path("Watered"), Tweak := Path("FALSE") }
                "Harvest" => array:
                    effect{ FN := "Is True", Focus := Path("Can Harvest") }
                    effect{ FN := "Set", Focus := Path("Stage"), Tweak := Path("ZERO") }
                    effect{ FN := "Set", Focus := Path("Plant Type"), Tweak := Path("EMPTY") }
        resource:
            ID := "Farmer"
            Props := map:
                "ZERO" => prop_float. Default := 0.0
                "ONE" => prop_float. Default := 1.0
                "-ONE" => prop_float. Default := -1.0
                "COMMA" => prop_str. Default := ","
                "Plant" => prop_str. Default := "Tomato"
                "Plot Type" => prop_str. Default := "Plot"
                "X" => prop_int{}
                "Y" => prop_int{}
                "Right" => prop_int{ Focus := Path("X"), FN := "+", Tweak := Path("ONE")}
                "Left" => prop_int{ Focus := Path("X"), FN := "+", Tweak := Path("-ONE")}
                "Forward" => prop_int{ Focus := Path("Y"), FN := "+", Tweak := Path("-ONE")}
                "Back" => prop_int{ Focus := Path("Y"), FN := "+", Tweak := Path("ONE")}
                "X Coord" => prop_float{ Focus := Path("X"), FN := "*", Tweak := Path("Grid Size") }
                "Y Coord" => prop_float{ Focus := Path("Y"), FN := "*", Tweak := Path("Grid Size") }
                "Grid Size" => prop_float. Default := 128.0
                "Count" => prop_num{}
                "XY Location" => prop_vec2{ Focus := Path("X Coord"), FN := "Append", Tweak := Path("Y Coord") }
                "Location" => prop_vec3{ Focus := Path("XY Location"), FN := "Append", Tweak := Path("ZERO") }
                "Partial ID" => prop_str{ Focus := Path("X"), FN := "Append", Tweak := Path("COMMA") }
                "Plot ID" => prop_str{ Focus := Path("Partial ID"), FN := "Append", Tweak := Path("Y") }
                "Can Plant" => prop_bool{ Focus := Path("Plot ID"), FN := "Adopt", Tweak := Path("Can Plant") }
                "Can Water" => prop_bool{ Focus := Path("Plot ID"), FN := "Adopt", Tweak := Path("Can Water") }
                "Can Harvest" => prop_bool{ Focus := Path("Plot ID"), FN := "Adopt", Tweak := Path("Can Harvest") }
            Abilities := map:
                "Action" => array:
                    effect{ FN := "Execute Ability", Focus := Path(Path("Plot ID"), "Water") }
                    effect{ FN := "Execute Ability", Focus := Path(Path("Plot ID"), "Plant") }
                    effect{ FN := "Execute Ability", Focus := Path(Path("Plot ID"), "Harvest") }
                    effect{ FN := "Execute Ability", Focus := Path("Create Plot") }
                "Create Plot" => array:
                    # TODO - Add If Not Exists check before creating
                    effect{ FN := "Create Resource", Focus := Path("Plot ID"), Tweak := Path("Plot Type") }
                    effect{ FN := "Set", Focus := Path(Path("Plot ID"), "X"), Tweak := Path("X")}
                    effect{ FN := "Set", Focus := Path(Path("Plot ID"), "Y"), Tweak := Path("Y")}
                    effect{ FN := "Increase", Focus := Path("Count"), Tweak := Path("ONE") }
                "Move Left" => array:
                    effect{ FN := "Set", Focus := Path("X"), Tweak := Path("Left") }
                "Move Right" => array:
                    effect{ FN := "Set", Focus := Path("X"), Tweak := Path("Right") }
                "Move Forward" => array:
                    effect{ FN := "Set", Focus := Path("Y"), Tweak := Path("Forward") }
                "Move Back" => array:
                    effect{ FN := "Set", Focus := Path("Y"), Tweak := Path("Back") }
