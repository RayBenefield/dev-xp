using { /Verse.org/Simulation }

using { Tableau }

CopyParticipant<constructor><public>(Old:participant)<transacts> := participant:
    ID := Old.ID
    Resources := Old.Resources

participant<public> := class<unique><concrete>():
    @editable ID<public>:string = ""

    # [ResourceID] => 0
    Resources<public>:[string]num = map{}

    AddResources<public>(ResourceID:string, Amount:num):participant=
        if (Amount.IsZero[]). return Self

        var NewResources:[string]num = Resources
        if (set NewResources[ResourceID] = GetResource(ResourceID) + Amount):
            return participant:
                CopyParticipant<constructor>(Self)
                Resources := NewResources
        else:
            return Self

    RemoveResources<public>(ResourceID:string, Amount:num)<decides><transacts>:participant=
        if (not GetResource(ResourceID).GreaterThanOrEqual[Amount]). false?

        var NewResources:[string]num = Resources
        if (set NewResources[ResourceID] = GetResource(ResourceID) - Amount):
            return participant:
                CopyParticipant<constructor>(Self)
                Resources := NewResources
        else:
            return Self

    GetResource<public>(ResourceID:string)<computes>:num = Resources[ResourceID] or num{}