using { /Verse.org/Simulation }

using { Tableau }

CopyParticipant<constructor>(Old:participant)<transacts> := participant:
    ID := Old.ID
    Resources := Old.Resources

participant<public> := class<unique><concrete>():
    @editable ID<public>:int = 0
    # @editable Resources<public>:num = num{}
    Resources<public>:[int]num = map{}

    AddResources<public>(ResourceID:int, Amount:num):participant=
        if (Amount.IsZero[]). return Self
        var NewResources:[int]num = Resources
        OldAmount := NewResources[ResourceID] or num{}
        NewAmount := OldAmount + Amount
        if (set NewResources[ResourceID] = NewAmount):
            return participant:
                CopyParticipant<constructor>(Self)
                Resources := NewResources
        else:
            return Self
