using { /Verse.org/Simulation }

using { Tableau }

CopyParticipant<constructor><public>(Old:participant)<transacts> := participant:
    ID := Old.ID
    Resources := Old.Resources

participant<public> := class<unique><concrete>():
    @editable ID<public>:int = 0
    # @editable Resources<public>:num = num{}
    Resources<public>:[int]num = map{}

    AddResources<public>(ResourceID:int, Amount:num):participant=
        if (Amount.IsZero[]). return Self

        var NewResources:[int]num = Resources
        if (set NewResources[ResourceID] = GetResource(ResourceID) + Amount):
            return participant:
                CopyParticipant<constructor>(Self)
                Resources := NewResources
        else:
            return Self

    RemoveResources<public>(ResourceID:int, Amount:num)<decides><transacts>:participant=
        if (Amount.IsZero[]). false?
        if (not GetResource(ResourceID).GreaterThanOrEqual[Amount]). false?

        var NewResources:[int]num = Resources
        if (set NewResources[ResourceID] = GetResource(ResourceID) - Amount):
            return participant:
                CopyParticipant<constructor>(Self)
                Resources := NewResources
        else:
            return Self

    GetResource<public>(ResourceID:int)<computes>:num=
        if (Amount := Resources[ResourceID]). Amount else. num{}