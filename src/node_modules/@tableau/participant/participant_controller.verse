using { Tableau }

participant_controller<public> := class(controller):
    Dispatcher<public>:dispatcher
    ParticipantService<public>:participant_service
    Effect<public>:grant_resources_effect

    Triage<override>()<suspends>:void =
        loop:
            # race:
                # Commands
                Command_AddResources()

    Command_AddResources()<suspends>:void=
        Command := Effect.AddResourcesCommand.Await()
        if:
            ParticipantIDs := Command.Subjects
            ResourceID := Command.Targets[0]
            Count := Command.Magnitudes[0]
        then:
            Dispatcher.Dispatch(ParticipantService.AddResources(ParticipantIDs, ResourceID, Count))
