
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }
using { TableauTesting }

participant_test := class(creative_device, test_suite):
    GetName<override>():string = "Participant"
    GetTests<override>():[]test_case = array:
        test_case:
            Name := "Should have no resources"
            Test := DefaultResources
        test_case:
            Name := "Should handle adding zero resources"
            Test := AddZeroResources
        test_case:
            Name := "Should handle adding resources from zero"
            Test := AddResourcesOnZero
        test_case:
            Name := "Should handle adding resources"
            Test := AddResources

    DefaultResources():?failure =
        # Arrange
        Participant := participant{ ID := 13 }

        # Act, Assert
        if (not Participant.Resources.Length = 0). return fail("We shouldn't have resources")

        # Pass
        return false

    AddZeroResources():?failure =
        # Arrange
        Participant := participant{ ID := 13 }
        ResourceID := 26

        # Act
        Result := Participant.AddResources(ResourceID, num{})

        # Assert
        if (not Result.Resources[ResourceID].IsZero[]). return fail("Resources should still be zero")

        # Pass
        return false

    AddResourcesOnZero():?failure =
        # Arrange
        Participant := participant{ ID := 13 }
        AmountToAdd := num{ Value := 1.23, Exponent := 3 }
        ResourceID := 26

        # Act
        Result := Participant.AddResources(ResourceID, num{ Value := 1.23, Exponent := 3 })

        # Assert
        if (not Result.Resources[ResourceID].Equals[AmountToAdd]). return fail("Resources should be the same")

        # Pass
        return false

    AddResources():?failure =
        # Arrange
        ResourceID := 26
        InitialAmount := num{ Value := 1.23, Exponent := 3 }
        Participant := participant{ ID := 13, Resources := map{ ResourceID => InitialAmount } }
        AmountToAdd := num{ Value := 1.23, Exponent := 3 }
        ExpectedAmount := num{ Value := 2.46, Exponent := 3 }

        # Act
        Result := Participant.AddResources(ResourceID, AmountToAdd)

        # Assert
        if (not Result.Resources[ResourceID].Equals[ExpectedAmount]). return fail("Resources should be what we expect")

        # Pass
        return false
