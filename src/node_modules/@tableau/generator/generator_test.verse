
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { TableauTesting }
using { TableauGenerator }

generator_test := class(creative_device, test_suite):
    GetName<override>():string = "Generator"
    GetTests<override>():[]test_case = array:
        test_case:
            Name := "Generator Non-Owner should not be maxed"
            Test := IsNotMaxed
        test_case:
            Name := "Generator Non-Owner should be maxed"
            Test := IsMaxed
        test_case:
            Name := "Generator should increase its count"
            Test := IncreaseCount
        test_case:
            Name := "Generator should not increase its count when maxed"
            Test := NoIncreaseCountCuzMax
        test_case:
            Name := "Should have no production rate none are owned"
            Test := GetNoRate
        test_case:
            Name := "Should have the default rate of production with 1 count"
            Test := GetDefaultRate
        test_case:
            Name := "Should have double the rate of production with 2 counts"
            Test := GetDoubleRate
        test_case:
            Name := "Should be visible"
            Test := BeVisible
        test_case:
            Name := "Should show"
            Test := ShowNow
        test_case:
            Name := "Should not show"
            Test := NotShowNow
        test_case:
            Name := "Should hide"
            Test := HideNow
        test_case:
            Name := "Should not hide"
            Test := NotHideNow

    IsNotMaxed():?failure =
        # Arrange
        Generator := generator{ ID := 13, MaxCount := 1, Counts := map{ 26 => 1, 39 => 0 } }

        # Act, Assert
        if (Generator.IsMaxed[39]). return fail("Generator shouldn't be maxed")

        # Pass
        return false

    IsMaxed():?failure =
        # Arrange
        Generator := generator{ ID := 13, MaxCount := 1, Counts := map{ 26 => 0, 39 => 1 } }

        # Act, Assert
        if (not Generator.IsMaxed[39]). return fail("Generator should be maxed")

        # Pass
        return false

    IncreaseCount():?failure =
        # Arrange
        Generator := generator{ ID := 13, MaxCount := 1, Counts := map{ 26 => 0 } }
        var NewGen:generator = Generator

        # Act
        if (Value := Generator.IncreaseCount[26], set NewGen = Value) {}

        # Assert
        Count := NewGen.GetCount(26)
        if (Count = 0). return fail("Generator count didn't increase")

        # Pass
        return false

    NoIncreaseCountCuzMax():?failure =
        # Arrange
        Generator := generator{ ID := 13, MaxCount := 1, Counts := map{ 26 => 1 } }
        var NewGen:generator = Generator

        # Act
        if (Value := Generator.IncreaseCount[26], set NewGen = Value) {}

        # Assert
        Count := NewGen.GetCount(26)
        if (Count = 2). return fail("Generator should not have increased")

        # Pass
        return false

    GetNoRate():?failure =
        # Arrange
        Generator := generator{ ID := 13, Counts := map{ 26 => 0 } }
        var NewGen:generator = Generator

        # Act
        Rate := Generator.GetProductionRate(26)

        # Assert
        if (Rate.Value <> 0.0 or Rate.Exponent <> 0). return fail("Should not have a production rate")

        # Pass
        return false

    GetDefaultRate():?failure =
        # Arrange
        Generator := generator{ ID := 13, Counts := map{ 26 => 1 } }
        var NewGen:generator = Generator

        # Act
        Rate := Generator.GetProductionRate(26)

        # Assert
        if (Rate.Value <> 1.67 or Rate.Exponent <> 0). return fail("Should have default production rate")

        # Pass
        return false

    GetDoubleRate():?failure =
        # Arrange
        Generator := generator{ ID := 13, Counts := map{ 26 => 2 } }
        var NewGen:generator = Generator

        # Act
        Rate := Generator.GetProductionRate(26)

        # Assert
        if (Rate.Value <> 3.34 or Rate.Exponent <> 0). return fail("Should have the expected production rate")

        # Pass
        return false

    BeVisible():?failure =
        # Arrange
        Gen:= generator{ ID := 13, Counts := map{ 26 => 1 } }

        # Act, Assert
        if (not Gen.ShouldBeVisible[26]). return fail("Should actually be visible")

        # Pass
        return false

    ShowNow():?failure =
        # Arrange
        OldGen := generator{ ID := 13, Counts := map{ 26 => 0 } }
        NewGen := generator{ ID := 13, Counts := map{ 26 => 1 } }

        # Act, Assert
        if (not NewGen.ShouldShowNow[OldGen, 26]). return fail("Should actually be visible")

        # Pass
        return false

    NotShowNow():?failure =
        # Arrange
        OldGen := generator{ ID := 13, Counts := map{ 26 => 1 } }
        NewGen := generator{ ID := 13, Counts := map{ 26 => 1 } }

        # Act, Assert
        if (NewGen.ShouldShowNow[OldGen, 26]). return fail("Should already be visible")

        # Pass
        return false

    HideNow():?failure =
        # Arrange
        OldGen := generator{ ID := 13, Counts := map{ 26 => 1 } }
        NewGen := generator{ ID := 13, Counts := map{ 26 => 0 } }

        # Act, Assert
        if (not NewGen.ShouldHideNow[OldGen, 26]). return fail("Should be hiding")

        # Pass
        return false

    NotHideNow():?failure =
        # Arrange
        OldGen := generator{ ID := 13, Counts := map{ 26 => 0 } }
        NewGen := generator{ ID := 13, Counts := map{ 26 => 0 } }

        # Act, Assert
        if (NewGen.ShouldHideNow[OldGen, 26]). return fail("Should not be hiding")

        # Pass
        return false
