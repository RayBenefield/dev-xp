using { Tableau }
using { TableauParticipant }

Ev_WorkStarted<constructor>(Type:entity, ID:string) := domain_event:
    SubjectType := Type
    Subject := ID
    Event := ev_work_started{}
Ev_WorkCompleted<constructor>(Type:entity, ID:string) := domain_event:
    SubjectType := Type
    Subject := ID
    Event := ev_work_completed{}

work_service<public> := class(service):
    Repo<public>:work_repository

    StartWork<public>(WorkID:string):[]domain_event=
        var DomainEvents:[]domain_event = array{}

        if:
            Work := Repo.GetByID[WorkID]
            NewWork := Work.StartWork[]
            Repo.Update[NewWork]
        then:
            set DomainEvents += array:
                Ev_WorkStarted(entity_work{}, NewWork.ID)

        return DomainEvents

    CompleteWork<public>(WorkID:string):[]domain_event=
        var DomainEvents:[]domain_event = array{}

        if:
            Work := Repo.GetByID[WorkID]
            NewWork := Work.CompleteWork[]
            Repo.Update[NewWork]
        then:
            set DomainEvents += array:
                Ev_WorkCompleted(entity_work{}, NewWork.ID)

        return DomainEvents
