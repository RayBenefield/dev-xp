
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }

producer_pos_hud_device<public> := class(creative_device, tableau_device):
    @editable ProducerIDs:[]int = array{}
    ToMessage<localizes>(Res:string, Count:string):message := "{Res}: {Count}"

    Init<override>(GameState:game_state)<suspends>:void=
        Watcher := participant_watcher:
            GameState := GameState
            OnPossessed := SetupUI
        Watcher.Start()

    SetupUI(GameState:game_state, ParticipantID:int, Agent:agent):void=
        VMs := for:
            ProducerID:ProducerIDs
            Producer := GameState.Producers[ProducerID]
            ProducerParticipant := Producer.Participants[ParticipantID]
        do:
            VM := producer_pos_vm:
                ID := ProducerID
                Name := Producer.Name
                Cost := ProducerParticipant.Cost
                Count := ProducerParticipant.Count
                Buy := ProducerParticipant.Buy

        ProducerPosUI := producer_pos_ui. VMs := VMs
        if (Player := player[Agent]). ProducerPosUI.AddForPlayer(Player)
