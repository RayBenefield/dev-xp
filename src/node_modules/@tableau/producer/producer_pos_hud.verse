
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }

producer_pos_hud_device<public> := class(creative_device, tableau_device):
    @editable ProducerIDs:[]string = array{}
    @editable HUDSettings:canvas_settings = canvas_settings{}

    BuyMsg(Name:string):string := "Buy x1 {Name}"
    CostMsg(Cost:string):string:= "Cost: {Cost}"
    CountMsg(Count:string):string := "Count: {Count}"
    ProdMsg(Amount:string):string := "Production: {Amount}"

    Init<override>(GameState:game_state)<suspends>:void=
        GameState.AddHUD(
            "Producer POS HUD",
            SetupHUD,
            HUDSettings,
            ?Clickable := true
        )

    SetupHUD(GameState:game_state, ParticipantID:string):game_hud=
        VMs := for:
            ProducerID:ProducerIDs
            Producer := GameState.Resources[ProducerID]
            Name := Producer.StatProps.Strs["Name"]
            Cost := Producer.CompProps.Nums["Cost"]
            Count := Producer.Props.Nums["Count"]
            Production := Producer.CompProps.Nums["Production Amount"]
            Affordable := Producer.CompProps.Bools["Can Afford"]
            Buy := Producer.Abilities["Buy"]
        do:
            NameVM := gooey_string. VM := Map(Name, BuyMsg)
            CountVM := gooey_string. VM := Map(Map(Count.ValueFor(ParticipantID), ToStr), CountMsg)
            CostVM := gooey_string. VM := Map(Map(Cost.ValueFor(ParticipantID), ToStr), CostMsg)
            ProdVM := gooey_string. VM := Map(Map(Production.ValueFor(ParticipantID), ToStr), ProdMsg)
            VM := producer_pos_vm:
                ID := ProducerID
                Name := NameVM
                Cost := CostVM
                Count := CountVM
                Production := ProdVM
                Affordable := Affordable.ValueFor(ParticipantID)
                Buy := Buy.ActionFor(ParticipantID).Execute
        producer_pos_ui. VMs := VMs

    ToStr(Count:num):string = "{Count}"
