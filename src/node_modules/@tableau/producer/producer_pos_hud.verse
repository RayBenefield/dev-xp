
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }

producer_pos_hud_device<public> := class(creative_device, tableau_device):
    @editable ProducerIDs:[]int = array{}
    BuyMsg<localizes>(Name:string):message := "Buy x1 {Name}"
    CostMsg<localizes>(Cost:string):message := "Cost: {Cost}"
    CountMsg<localizes>(Count:string):message := "Count: {Count}"

    Init<override>(GameState:game_state)<suspends>:void=
        GameState.AddHUD("Producer POS HUD", SetupHUD, ?Clickable := true)

    SetupHUD(GameState:game_state, ParticipantID:int):game_hud=
        VMs := for:
            ProducerID:ProducerIDs
            Producer := GameState.Resources[ProducerID]
            Name := Producer.StaticProperties["Name"]
            Cost := Producer.Properties["Count"]
            Count := Producer.Properties["Count"]
            Buy := Producer.Abilities["Buy"]
        do:
            CountVM := Map(Map(Count.ValueFor(ParticipantID), ToStr), CountMsg)
            CostVM := Map(Map(Cost.ValueFor(ParticipantID), ToStr), CostMsg)
            VM := producer_pos_vm:
                ID := ProducerID
                Name := gooey_message. VM := Map(Name, BuyMsg)
                Cost := gooey_message. VM := CostVM
                Count := gooey_message. VM := CountVM
                Buy := Buy.ActionFor(ParticipantID).Execute
        producer_pos_ui. VMs := VMs

    ToStr(Count:num):string = "{Count}"
