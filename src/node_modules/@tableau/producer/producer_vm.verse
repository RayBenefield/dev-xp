using { Tableau }

producer_vm<public> := class():
    ID<public>:int
    Name<public>:gooey_message = gooey_message{}
    var Participants<public>:[int]producer_participant_vm = map{}

    Init<public>(Producer:producer)<suspends>:void=
        spawn. Name.Init(Str2Msg("Buy x1 {Producer.Name}"))

    # TODO: Convert to `gooey_num` when we can map to `num->string` with Gooey
    AddParticipant<public>(ParticipantID:int, Producer:producer)<suspends>:void =
        VM := producer_participant_vm. ID := ParticipantID
        spawn. VM.Init(Producer)
        if:
            set Participants[ParticipantID] = VM

producer_participant_vm<public> := class():
    ID<public>:int
    Cost<public>:gooey_message = gooey_message{}
    Count<public>:gooey_message = gooey_message{}

    Init<public>(Producer:producer)<suspends>:void=
        Amount := Producer.GetCost[ID].Amount or num{}
        spawn. Cost.Init(Str2Msg("Cost: {Amount}"))
        spawn. Count.Init(Str2Msg("Count: {Producer.GetCount(ID)}"))
