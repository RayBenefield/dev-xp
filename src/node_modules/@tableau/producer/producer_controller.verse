using { Tableau }
using { TableauAgent }

producer_controller<public> := class(controller):
    Dispatcher<public>:dispatcher
    ProducerService<public>:producer_service
    BuyEffector<public>:buy_producer_effector
    ProduceEffector<public>:produce_effector

    Triage<override>()<suspends>:void =
        loop:
            race:
                # Commands
                Command_Buy()
                Command_Produce()

    Command_Buy()<suspends>:void=
        Command := BuyEffector.BuyProducerCommand.Await()
        ProducerID := Command.Subject
        BuyerID := Command.Target
        Dispatcher.Dispatch(ProducerService.Buy(ProducerID, BuyerID))

    Command_Produce()<suspends>:void=
        Command := ProduceEffector.ProduceCommand.Await()
        ProducerID := Command.Subject
        ParticipantID:= Command.Target
        Dispatcher.Dispatch(ProducerService.Produce(ProducerID, ParticipantID))
