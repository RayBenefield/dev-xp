using { /Fortnite.com/UI }
using { /Verse.org/Simulation }
using { /Verse.org/Colors/NamedColors }
using { /UnrealEngine.com/Temporary/UI }
using { /UnrealEngine.com/Temporary/SpatialMath }

using { Tableau }
using { TableauResource }

buy_producer_ui<public> := class():
    VM<public>:producer_pos_vm

    Initialize<public>():[]widget =
        CostTextBlock := text_block:
            DefaultText := Str2Msg("Cost: 0")
            DefaultTextColor := White
            DefaultShadowOffset := option. vector2{X:=2.5,Y:=2.5}
            DefaultShadowColor := Black
        CountTextBlock := text_block:
            DefaultText := Str2Msg("Count: 0")
            DefaultTextColor := White
            DefaultShadowOffset := option. vector2{X:=2.5,Y:=2.5}
            DefaultShadowColor := Black
        ButtonTextBlock := text_block:
            DefaultText := Str2Msg("Buy")
            DefaultTextColor := White
            DefaultShadowOffset := option. vector2{X:=2.5,Y:=2.5}
            DefaultShadowColor := Black
        Button := button:
            Slot := button_slot:
                Widget := ButtonTextBlock
        ButtonTextBlock.SetShadowOpacity(1.0)
        BuyText := responsive_text_block:
            GooeyText := VM.Name
            TextBlock := ButtonTextBlock
        CostText := responsive_text_block:
            GooeyText := VM.Cost
            TextBlock := CostTextBlock
        CountText:= responsive_text_block:
            GooeyText := VM.Count
            TextBlock := CountTextBlock

        Button.OnClick().Subscribe(OnPressed)

        spawn. BuyText.Initialize()
        spawn. CostText.Initialize()
        spawn. CountText.Initialize()

        return array:
            Button
            CostTextBlock
            CountTextBlock

    OnPressed(Msg:widget_message):void = VM.Buy()

producer_pos_ui<public> := class():
    VMs<public>:[]producer_pos_vm
    MinimumAnchor<public>:vector2 = vector2{X:=0.25,Y:=0.25}
    MaximumAnchor<public>:vector2 = vector2{X:=0.25,Y:=0.25}

    BuyEvent<public>:event(int) = event(int){}
    AddForPlayer<public>(Player:player):void=
        ProducerUIs:[]buy_producer_ui = for(VM:VMs). buy_producer_ui. VM := VM
        Widgets:[]widget = Concatenate(for(ProducerUI:ProducerUIs). ProducerUI.Initialize())
        if (PlayerUI := GetPlayerUI[Player]):
            AllWidgets := stack_box:
                Orientation := orientation.Vertical
                Slots := for(Widget:Widgets):
                    stack_box_slot:
                        Widget := Widget
                        Padding := margin{Left:=20.0}
                        HorizontalAlignment := horizontal_alignment.Fill
                        VerticalAlignment := vertical_alignment.Center
            Canvas := MakeCanvas(AllWidgets)
            PlayerUI.AddWidget(Canvas, player_ui_slot{InputMode := ui_input_mode.All})

    MakeCanvas(Widget:widget):canvas=
        canvas:
            Slots := array:
                canvas_slot:
                    Anchors := anchors{Minimum:=MinimumAnchor,Maximum:=MaximumAnchor}
                    Offsets := margin{}
                    Alignment := vector2{X:=0.0,Y:=0.0}
                    SizeToContent := true
                    Widget := stack_box:
                        Orientation := orientation.Vertical
                        Slots := array:
                            stack_box_slot:
                                HorizontalAlignment := horizontal_alignment.Left
                                VerticalAlignment := vertical_alignment.Fill
                                Widget := overlay:
                                    Slots := array:
                                        overlay_slot:
                                            Widget := stack_box:
                                                Orientation := orientation.Horizontal
                                                Slots := array:
                                                    stack_box_slot:
                                                        Widget := Widget
                                                        Padding := margin{Left:=20.0}
                                                        HorizontalAlignment := horizontal_alignment.Fill
                                                        VerticalAlignment := vertical_alignment.Center
                                            Padding := margin{Left:=30.0,Right:=30.0}
                                            HorizontalAlignment := horizontal_alignment.Center
                                            VerticalAlignment := vertical_alignment.Center
