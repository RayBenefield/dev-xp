
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }
using { TableauTesting }

resource_repository_test := class(creative_device, test_suite):
    GetName<override>():string = "Resource Repository"
    GetTests<override>():[]test_case = array:
        test_case:
            Name := "Should be fetchable by ID with initial data"
            Test := FetchWithInitial
        test_case:
            Name := "Should be fetchable by ID with Load"
            Test := FetchWithLoad
        test_case:
            Name := "Should clear existing when loading"
            Test := LoadShouldClearInitial
        test_case:
            Name := "Should be updated"
            Test := Update

    FetchWithInitial():?failure =
        # Arrange
        ID := 13
        Resource := resource. ID := ID
        Repo := resource_repository. Initial := array. Resource

        # Act, Assert
        if (not Repo.GetByID[ID]). return fail("Can't get resource")

        # Pass
        return false

    FetchWithLoad():?failure =
        # Arrange
        ID := 13
        Resource := resource. ID := ID
        Repo := resource_repository{}
        Repo.Load(array. Resource)

        # Act, Assert
        if (not Repo.GetByID[ID]). return fail("Can't get resource")

        # Pass
        return false

    LoadShouldClearInitial():?failure =
        # Arrange
        ID := 13
        Resource := resource. ID := 12
        NewResource := resource. ID := 13
        Repo := resource_repository. Initial := array. Resource
        Repo.Load(array. NewResource)

        # Act
        Resources := Repo.GetAll()

        # Assert
        if (not Resources.Length = 1). return fail("More than one resource was returned")
        if (not Resources[0].ID = ID). return fail("First resource isn't the right one")

        # Pass
        return false

    Update():?failure =
        # Arrange
        ID := 13
        Resource := resource{ ID := ID, Name := "First" }
        Repo := resource_repository. Initial := array. Resource
        NewResource := resource{ ID := ID, Name := "Second" }

        # Act
        if (Part := Repo.Update[NewResource]):
            # Assert
            if (not Part.Name = "Second"). return fail("Name was not updated")
        else:
            return fail("Resource could not be updated")

        # Pass
        return false
