
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }

resource_hud_device<public> := class(creative_device, tableau_device):
    @editable ResourceID:int = 0

    Init<override>(GameState:game_state)<suspends>:void=
        ResourceHUDManager := resource_hud_manager. GameState := GameState

        loop:
            ID := GameState.ParticipantAdded.Await()
            spawn. ResourceHUDManager.ManageParticipant(ID, ResourceID)

resource_hud_manager := class():
    GameState:game_state
    ToMessage<localizes>(Res:string, Count:string):message := "{Res}: {Count}"

    ManageParticipant(ID:int, ResID:int)<suspends>:void =
        if (Participant := GameState.Participants[ID]):
            loop:
                MaybeAgent := Participant.Agent.UpdatedEvent().Await()
                if:
                    Agent := MaybeAgent?
                    Res := GameState.Resources[ID]
                    ResCount := Participant.Resources[ResID]
                then:
                    ComputedVM := Computed(Res.Name, ResCount, ToMessage)
                    MessageVM := gooey_message. VM := ComputedVM
                    ResourceUI:resource_ui = resource_ui. VM := MessageVM
                    if (Player := player[Agent]). ResourceUI.AddForPlayer(Player)
