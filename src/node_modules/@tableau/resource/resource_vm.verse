
using { Tableau }

resource_vm<public> := class():
    ID<public>:int
    BuyEffector<public>:effector
    Name<public>:gooey_string := gooey_string{}
    var StaticProperties<public>:[string]gooey_string = map{}
    var Properties<public>:[string]resource_property_vm = map{}
    var Abilities<public>:[string]action_maker = map{}

    Init<public>(Resource:resource)<suspends>:void =
        spawn. Name.Init(Resource.Name)
        for (Property:Resource.StaticProperties):
            VM := gooey_string{}
            spawn. VM.Init("Gold")
            if:
                set StaticProperties[Property.ID] = VM
        for (Property:Resource.Properties):
            VM := resource_property_vm{ Default := "2.7K" }
            spawn. VM.Init(Property.ID)
            if:
                set Properties[Property.ID] = VM
        for (Ability:Resource.Abilities):
            if:
                set Abilities[Ability.ID] = action_maker:
                    Subject := Resource.ID
                    Effector := BuyEffector

resource_static_property_vm<public> := class():
    ID<public>:gooey_string := gooey_string{}
    Default<public>:string

    Init<public>(PropertyID:string)<suspends>:void =
        spawn. ID.Init(PropertyID)

resource_property_vm<public> := class():
    ID<public>:gooey_string := gooey_string{}
    Default<public>:string
    var Values<public>:[int]gooey_string := map{}

    Init<public>(PropertyID:string)<suspends>:void =
        spawn. ID.Init(PropertyID)

    ValueFor<public>(ParticipantID:int):gooey_string =
        if (Value := Values[ParticipantID]). return Value
        VM := gooey_string{}
        spawn. VM.Init(Default)
        if:
            set Values[ParticipantID] = VM

        return VM

action_maker<public> := class():
    Subject<public>:int
    Effector<public>:effector

    ActionFor<public>(NewTarget:int):action=
        action:
            Subject := Subject
            Target := NewTarget
            Effector := Effector

action<public> := class():
    Subject<public>:int
    Target<public>:int
    Effector<public>:effector

    Execute<public>():void = Effector.Play(
        command:
            Subjects := array. Subject
            Targets := array. Target
    )
