
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }

producer_settings<public> := class<concrete>():
    @editable ID:string = ""
    @editable BaseCost:float = 3.738
    @editable CostGrowth:float = 1.07
    @editable Production:float = 1.67

CreateProducerResource<public><constructor>(Name:string, Production:float, CostGrowth:float, BaseCost:float) := resource:
    ID := Name
    StatProps := props:
        Strs := array:
            prop_str{ ID := "Name", Default := Name }
        Floats := array:
            prop_float{ ID := "Cost Growth", Default := CostGrowth }
            prop_float{ ID := "Base Cost", Default := BaseCost }
        # property{ ID := "Cost Resource" }
        # property{ ID := "Production Resource" }
        # property{ ID := "First Is Free" }
        # property{ ID := "Required Producers" }
    Props := props:
        Nums := array:
            prop_num{ ID := "Count", Default := num{} }
        Floats := array:
            prop_float{ ID := "Production", Default := Production }
        # property{ ID := "Max Count" }
        # property{ ID := "Cost Growth" }
        # property{ ID := "Production Rate" }
        # property{ ID := "Production" }
    CompProps := comp_props:
        Nums := array:
            comp_num:
                ID := "Production Amount"
                BaseProp := "Count"
                Computer := computer{ FN := "Multiply", Pay := Load(Path(Name, "Production")) }
            comp_num:
                ID := "Cost Rate"
                BaseProp := "Cost Growth"
                Computer := computer{ FN := "Power", Pay := Load(Path(Name, "Count")) }
            comp_num:
                ID := "Cost"
                BaseProp := "Cost Rate"
                Computer := computer{ FN := "Multiply", Pay := Load(Path(Name, "Base Cost")) }
        Bools := array:
            comp_bool:
                ID := "Can Afford"
                BaseResource := "Gold"
                BaseProp := "Count"
                Computer := computer{ FN := ">=", Pay := Load(Path("Cost")) }
    Abilities := array:
        ability:
            ID := "Buy"
            Effects := array:
                effect{ FN := "Is True", Focus := option. Path("Can Afford") }
                effect{ FN := "Decrease", Focus := option. Path("Gold", "Count"), Pay := Load(Path(Name, "Cost")) }
                effect{ FN := "Increase", Focus := option. Path("Count"), Pay := load. Float := 1.0 }
                # effect{ FN := "Get Property", Pay := load. Str := "Count" }
                # effect{ FN := "Increase", Pay := load. Float := 1.0 }
                # effect{ FN := "Set Property", Pay := load. Str := "Count" }
                # effect{ FN := "Change Subject", Pay := load. Str := "Gold" }
                # effect{ FN := "Get Property", Pay := load. Str := "Count" }
                # effect{ FN := "Decrease", Pay := load. Str := "Cost" }
                # effect{ FN := "Increase", Pay := load. Float := 2.0 }
                # effect{ FN := "Set Property", Pay := load. Str := "Count" }
    #             effector{ FN := "Has Required" }
    #             effector{ FN := "Can Afford" }
    #             effector{ FN := "Not Maxed" }
    #             effector{ FN := "Pay Cost" }
        ability:
            ID := "Produce"
            Effects := array:
                effect{ FN := "Execute Ability", Focus := option. Path("Gold", "Increase Count"), Pay := Load(Path(Name, "Production Amount")) }
                # effect{ FN := "Get Property", Pay := load. Str := "Production Amount" }
                # effect{ FN := "Change Subject", Pay := load. Str := "Gold" }
                # effect{ FN := "Execute Ability", Pay := load. Str := "Increase Count" }
    # Triggers := array:
    #     trigger{ ID := "Produce Timer", FN := "Timer" }
    #     trigger{ ID := "Buy Zone", FN := "Proximity" }
    # Checks := array:
    #     check{ ID := "Owned By" }
    #     check{ ID := "Is Maxed" }
    #     check{ ID := "Has Required" }
    #     check{ ID := "Can Afford" }

producer_config<public> := class(creative_device, config_device):
    @editable ProducerSettings<public>:[]producer_settings = array{}

    GetResources<override>():[]resource=
        for (P:ProducerSettings):
            CreateProducerResource(P.ID, P.Production, P.CostGrowth, P.BaseCost)
