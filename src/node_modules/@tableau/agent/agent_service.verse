using { /Verse.org/Simulation }

using { Tableau }
using { TableauParticipant }

agent_service<public> := class(service):
    Repo<public>:agent_repository

    PossessParticipant<public>(Agent:agent, ParticipantID:string):[]domain_event=
        var DomainEvents:[]domain_event = array{}
        if (OldParticipantID := Repo.GetParticipant[Agent]?):
            Repo.ClearAgent(OldParticipantID)
            set DomainEvents += array. Ev_ParticipantAbandoned(OldParticipantID)

        Repo.UpdateAgent(Agent, ParticipantID)
        set DomainEvents += array. Ev_ParticipantPossessed(ParticipantID)

        return DomainEvents
