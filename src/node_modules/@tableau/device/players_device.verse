
using. /Verse.org/Simulation
using. /Fortnite.com/Devices
using. /Fortnite.com/Characters
using. /Fortnite.com/Playspaces

using. Tableau

player_manager := class():
    Playspace:fort_playspace
    CreatePlayerEvent<public>:event(resource) = event(resource){}
    Init<public>()<suspends>:void=
        Playspace.PlayerAddedEvent().Subscribe(AddNewPlayer)
        StartingPlayers := Playspace.GetPlayers()
        for(ID->Player:StartingPlayers). AddPlayer(Player, ID+1)
    AddNewPlayer<public>(Player:player):void=
        AddPlayer(Player, Playspace.GetPlayers().Length)
    AddPlayer<public>(Player:player, ID:int):void=
        CreatePlayerEvent.Signal(CreatePlayerResource(ID, Player, player_settings{}))

players_device := class(tableau_device):
    ResourceID<override>:string = "Player Manager"
    GetSideEffectSettings<override>()<transacts>:side_effect_settings= StaticResourceSideEffects()
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        PlayerManager := player_manager. Playspace := GetPlayspace()
        array:
            StartWith(PlayerManager.Init)
            Generate(PlayerManager.CreatePlayerEvent)
