
using. /Fortnite.com/Devices
using. /Verse.org/Simulation

using. Vertex

CreateSelectorResource<public>(ResourceID:string, Items:[]string, Wrap:logic):resource=
    CreatedProps := CombineAll of array:
        CreateMap of for(Item:Items). ("{Item} Label", Str of Item)
        CreateMap of for(Item:Items). ("Is {Item}", Bool of (Path("Selection"), "String Equals", Path("{Item} Label")))

    CreatedActions := CombineAll of array:
        # TODO: When we support direct Integer values, this should set current index,
        #       cuz direct setting will result in current selection not matching index
        CreateMap of for(Item:Items). ("Set {Item}", Action of Set("Selection").To("{Item} Label"))

    resource:
        ID := ResourceID
        Props := CreatedProps.CombineWithAll of map:
            "All Types" => Strs of Items
            "Selection" => Str of (Path("All Types"), "Get", Path("Next Index"))
            "Next Index" => Integer of 1
            "New Index" => Integer of (Path("Next Index"), "+", ONE())
            "Previous Index" => Integer of (Path("Next Index"), "-", ONE())
            "Type Count" => Integer of (Path("All Types"), "Length")
            "Is Last Type" => Bool of (Path("Next Index"), "Int >=", Path("Type Count"))
            "Is First Type" => Bool of (Path("Next Index"), "Int <=", ONE())
            "Wrap" => Bool of Wrap
        Actions := CreatedActions.CombineWithAll of map:
            "Next" => Action of array:
                IsTrue("Is Last Type").Else("Go to Next")
                IsTrue("Wrap")
                Set("Next Index").To(ONE())
            "Previous" => Action of array:
                IsTrue("Is First Type").Else("Go to Previous")
                IsTrue("Wrap")
                Set("Next Index").To("Type Count")
            "Go to Next" => Action of Set("Next Index").To("New Index")
            "Go to Previous" => Action of Set("Next Index").To("Previous Index")

selector_device<public> := class(tableau_device):
    @editable ResourceID<override>:string = "Selector"
    @editable Items<public>:[]string = array{}
    @editable Wrap<public>:logic = true

    GetResources<override>():[]resource= array. CreateSelectorResource(ResourceID, Items, Wrap)