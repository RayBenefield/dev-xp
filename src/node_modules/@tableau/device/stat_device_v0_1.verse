
using. /Verse.org/Simulation
using. /Fortnite.com/Devices

using. Tableau

StatController<public><constructor>(StatCreator:stat_creator_device, KeepValueOnLevelUp:logic, ZeroBasedLeveling:logic)<transacts> := set_stat{ StatCreator := StatCreator, KeepValueOnLevelUp := KeepValueOnLevelUp, ZeroBasedLeveling := ZeroBasedLeveling }
set_stat<public> := class():
    StatCreator<public>:stat_creator_device
    KeepValueOnLevelUp<public>:logic
    ZeroBasedLeveling<public>:logic
    var Agent<public>:?agent = false
    var LastValue<public>:?int = false
    SetAgent<public>(Value:?agent):void=
        set Agent = Value
        if (PendingValue := LastValue?). SetValue(PendingValue)
    SetValue<public>(Value:int):void=
        set LastValue = option. Value
        if. StatCreator.SetValue[Agent?, Value]
    SetLevel<public>(Value:int):void=
        Level := if(ZeroBasedLeveling?). Value+1 else. Value
        if. StatCreator.SetLevel[Agent?, Level]
        if. KeepValueOnLevelUp? and StatCreator.SetValue[Agent?, LastValue? or 0]

stat_device_v0_1<public> := class(tableau_device):
    @editable StatCreator:stat_creator_device = stat_creator_device{}
    @editable ValueSource<public>:prop_path = prop_path{}
    @editable LevelSource<public>:prop_path = prop_path{}
    @editable KeepValueOnLevelUp<public>:logic = false
    @editable ZeroBasedLeveling<public>:logic = false

    GetSideEffects<override>()<suspends>:[]side_effect=
        Controller := StatController(StatCreator, KeepValueOnLevelUp, ZeroBasedLeveling)
        array:
            PushAgent(SubPath("Possessed By"), Controller.SetAgent)
            PushInt(ValueSource, Controller.SetValue)
            PushInt(LevelSource, Controller.SetLevel)
