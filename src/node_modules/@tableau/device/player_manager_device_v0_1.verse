
using. /Verse.org/Simulation
using. /Fortnite.com/Devices
using. /Fortnite.com/Playspaces

using. Tableau

player_manager_v0_1 := class():
    Playspace:fort_playspace
    CreatePlayerEvent<public>:event(resource) = event(resource){}
    Init<public>()<suspends>:void=
        Playspace.PlayerAddedEvent().Subscribe(AddNewPlayer)
        StartingPlayers := Playspace.GetPlayers()
        for(ID->Player:StartingPlayers). AddPlayer(Player, ID+1)
    AddNewPlayer<public>(Player:player):void=
        AddPlayer(Player, Playspace.GetPlayers().Length)
    AddPlayer<public>(Player:player, ID:int):void=
        CreatePlayerEvent.Signal of resource:
            ID := "Player{ID}"
            Type := "Player"
            Props := map{ "Possessed By" => UEAgent of option. Player }

player_manager_device_v0_1 := class(tableau_device):
    DeviceType<override>:string = "PLAYER MANAGER"

    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        PlayerManager := player_manager_v0_1. Playspace := GetPlayspace()
        array:
            StartWith(PlayerManager.Init)
            Generate(PlayerManager.CreatePlayerEvent)
