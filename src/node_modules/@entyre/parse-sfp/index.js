import frontMatter from 'front-matter'

/* eslint-disable no-nested-ternary */
export default ({ content = '' } = {}) => {
    const { attributes: config, body } = frontMatter(content)
    return {
        config,
        code: body.split('\n').reduce(
            ({ inBlock, bundle }, line) =>
                line.slice(0, 3) === '```'
                    ? /* eslint-disable indent */
                      { inBlock: !inBlock, bundle }
                    : /* eslint-disable indent */
                      inBlock
                        ? {
                              inBlock,
                              bundle: bundle ? `${bundle}\n${line}` : line,
                          }
                        : { inBlock, bundle },
            { inBlock: false, bundle: '' }
        ).bundle,
    }
}
