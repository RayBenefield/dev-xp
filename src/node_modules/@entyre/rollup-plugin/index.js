import fs from 'fs'
import { extname } from 'path'
import parse from '@entyre/parse-sfp'

export default ({
    readmePath = './readme.md',
    packageJsonPath = './package.json',
    config = {},
    readme = '',
} = {}) => ({
    name: 'entyre',
    transform(content, id) {
        if (extname(id) !== '.md') return { code: content }

        const { body, code, attributes = {} } = parse({ content })
        readme = body
        config = attributes
        return { code }
    },
    onwrite() {
        fs.writeFileSync(
            packageJsonPath,
            JSON.stringify(config, null, 4),
            'utf-8'
        )
        fs.writeFileSync(readmePath, readme, 'utf-8')
    },
})
