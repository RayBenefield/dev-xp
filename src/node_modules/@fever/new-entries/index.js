import { map, skip, filter, debounceTime } from 'rxjs/operators'

export default ({ logger: baseLogger, moderator }) => {
    const logger = baseLogger.child({ plugin: '@fever/new-entries' })

    moderator.entryChanges$
        .pipe(
            debounceTime(1),
            skip(1),
            filter(({ type }) => type === 'added'),
            map(({ doc }) => doc.data()),
            filter(({ name }) => name !== 'raybenefield')
        )
        .subscribe(({ name }) => {
            logger.platform(`${name} has entered this week's giveaway.`)
            moderator.whisper({
                userName: name,
                message: `You've been given an entry for #FeverFam giveaways.`,
            })
        })
}
