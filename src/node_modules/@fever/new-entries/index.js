import { tap, map, skip, filter, debounceTime } from 'rxjs/operators'

export default ({ logger, moderator }) =>
    moderator.entryChanges$
        .pipe(
            debounceTime(1),
            skip(1),
            filter(({ type }) => type === 'added'),
            map(({ doc }) => doc.data()),
            filter(({ name }) => name !== 'raybenefield'),
            tap(({ name }) => {
                logger.platform(`${name} has entered this week's giveaway.`)
                moderator.whisper({
                    userName: name,
                    message: `You've been given an entry for #FeverFam giveaways.`,
                })
            })
        )
        .subscribe()
