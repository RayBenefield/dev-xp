import { tap } from 'rxjs/operators'

export default ({ moderator, db, logger }) =>
    moderator.command$('clear-code', { streamer: true, mod: true }).pipe(
        moderator.currentCode(),
        moderator.gate(
            ([, { code }]) => code,
            'There is currently no active code.'
        ),
        tap(() => db.set('codes/current', { code: '', mode: '', server: '' })),
        tap(([{ userName }]) => {
            moderator.whisperStreamer(`[${userName}] just cleared the code.`)
            moderator.whisper({
                userName,
                message: 'Cleared the current code.',
            })
            logger.extend(`[${userName}] just cleared the code.`)
        })
    )
