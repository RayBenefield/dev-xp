import { tap, filter } from 'rxjs/operators'

export default ({ chat }) => (gateFilter, message) => stream$ =>
    stream$.pipe(
        tap(args => {
            const user = Array.isArray(args) ? args[0].userName : args.userName
            const msg = typeof message === 'function' ? message(args) : message

            if (!gateFilter(args)) chat.whisper(user, msg)
        }),
        filter(gateFilter)
    )
