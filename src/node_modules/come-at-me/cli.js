import { resolve } from 'path'

import { config } from 'dotenv'
import createDb from '@rampant-firebase/db'
import { createLogger } from '@rampant/logger'
import createMixerChat from '@rampant-mixer/chat'
import comeAtMe from '@rampant-giveaway/come-at-me'
import { sync as root } from '@kikd/find-repo-root'

config({ path: resolve(root(), '.env') })

const {
    MIXER_CLIENT_ID: clientId,
    DATABASE_ID: dbId,
    LOG_LEVEL,
    STREAMER_ID: userId,
    CHANNEL_ID: channelId,
} = process.env

const logger = createLogger({ level: LOG_LEVEL })
const db = createDb({ id: dbId, logger })
const mixerChat = createMixerChat({ clientId, db })
mixerChat({ channelId, userId }).then(moderator => {
    logger.platform(`Chat setup for [${channelId}] as [${userId}]`)
    comeAtMe({ db, logger, moderator })
})
