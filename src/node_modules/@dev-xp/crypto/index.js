import crypto from 'crypto'

const algorithm = 'aes-256-ctr'

export default password => ({
    encrypt: obj => {
        const text = JSON.stringify(obj)
        const iv = crypto.randomBytes(16)
        const cipher = crypto.createCipheriv(algorithm, password, iv)
        let crypted = cipher.update(text, 'utf8', 'hex')
        crypted += cipher.final('hex')
        return `${iv.toString('hex')}:${crypted}`
    },
    decrypt: crypted => {
        const [iv, encrypted] = crypted.split(':')
        const decipher = crypto.createDecipheriv(
            algorithm,
            password,
            Buffer.from(iv, 'hex')
        )
        let text = decipher.update(encrypted, 'hex', 'utf8')
        text += decipher.final('utf8')
        const obj = JSON.parse(text)
        return obj
    },
})
