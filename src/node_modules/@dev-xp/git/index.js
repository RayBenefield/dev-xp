import log from '@dev-xp/log'
import diffParser from 'gitdiff-parser'
import { sync as root } from '@dev-xp/root'
import configureGit from 'simple-git/promise'
import patchObject from '@dev-xp/patch-object'
import camelCaseKeys from '@dev-xp/camel-case-keys'

const patch = patchObject({
    status: camelCaseKeys,
    diff: diffParser.parse,
})
const makeGit = () => patch(configureGit(root()))

export const silent = makeGit()

export default makeGit().outputHandler((command, stdout, stderr) => {
    stdout.pipe(process.stdout)
    stderr.pipe(process.stderr)
})
