/* eslint-disable global-require, import/no-dynamic-require */
import findModules from '@dev-xp/find-modules'
import createModerator from '@rampant/moderator'
import createGiveawayRepo from '@rampant-giveaway/repo'

export default ({ moderator: chat, db, prefix, logger: baseLogger }) => {
    const moderator = createModerator({
        chat,
        db,
        prefix,
        streamer: 'raybenefield',
    })
    const intents = findModules({ namespace: '@fever' })
    const giveawayRepo = createGiveawayRepo({ db, logger: baseLogger })
    intents.forEach(name => {
        const intent = require(name).default
        const logger = baseLogger.child({ plugin: name })
        intent({ moderator, db, prefix, logger, giveawayRepo }).subscribe()
        logger.platform('Intent Loaded')
    })
}
