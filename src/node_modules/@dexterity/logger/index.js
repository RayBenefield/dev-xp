import winston from 'winston'
import { stringify } from 'javascript-stringify'

const { createLogger: createWinstonLogger, transports, format } = winston
const { combine, timestamp, colorize, printf } = format

const cliFormat = printf(
    ({ level, message, timestamp: msgTimestamp }) =>
        `${msgTimestamp} ${level}: ${message}`
)

export const prettify = obj => `\n${stringify(obj, null, '    ')}`

export const createLogger = ({ level }) => {
    const config = logLevel => ({
        format: combine(timestamp(), colorize(), cliFormat),
        transports: [new transports.Console({ level: logLevel })],
    })

    const logger = createWinstonLogger(config(level))
    logger.changeLevel = ({ level: logLevel }) =>
        logger.configure(config(logLevel))

    return logger
}

export default createLogger
