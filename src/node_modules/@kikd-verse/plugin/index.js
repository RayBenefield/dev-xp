import match from 'minimatch'
import { resolve } from 'path'

import log from '@dev-xp/log'
import { rmdir, copy } from '@dev-xp/fs'

const type = 'verse'

export default {
    type,
    filter: ({ files = [] }) => files.some(file => match(file, '*.verse')),
    config: ({ structure }) => ({
        type,
        post: { ...structure },
    }),
    build: ({
        config: {
            post: { root, srcDir, destDir, files = [] },
        },
    }) => {
        rmdir(resolve(root, destDir))
        return Promise.all(
            files.map(file => {
                const src = resolve(root, srcDir, file)
                const dest = resolve(root, destDir, file)
                return copy(src, dest)
            })
        )
    },
}
