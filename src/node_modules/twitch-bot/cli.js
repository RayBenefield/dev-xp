import '@dev-xp/config'
import createDb from '@rampant/db'
import { tap } from 'rxjs/operators'
// import weekOf from '@rampant-giveaway/week-of'
import { createLogger } from '@rampant/logger'
import createTwitchChat from '@rampant-twitch/chat'
// import selection from '@rampant-giveaway/selection'

const {
    TWITCH_CLIENT_ID: clientId,
    TWITCH_CLIENT_SECRET: clientSecret,
    DATABASE_ID: dbId,
    LOG_LEVEL,
    STREAMER_ID: userId,
} = process.env

const logger = createLogger({ level: LOG_LEVEL })
const db = createDb({ id: dbId, logger })
const chatCreator = createTwitchChat({ clientId, clientSecret, db })
chatCreator({ userId, channelId: userId }).then(chat =>
    chat
        .pipe(tap(({ user, text }) => console.log(`[${user}]: ${text}`)))
        .subscribe()
)

/*
const mixerChat = createMixerChat({ clientId, db })
mixerChat({ channelId, userId }).then(moderator => {
    logger.platform(`Chat setup for [${channelId}] as [${userId}]`)

    const monday = weekOf(new Date(), 0)
    const week = `${monday.getFullYear()}-${monday.getMonth() +
        1}-${monday.getDate()}`
    logger.platform(`Collecting entries for the week of: ${week}`)
    selection({ prefix: week, db, moderator, logger })
})
*/
