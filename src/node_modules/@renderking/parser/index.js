import P from 'parsimmon';

const ltag = P.string('<');
const rtag = P.string('>');
const close = P.string('/');

const identifier = P.regexp(/[a-z_][a-z0-9_]*/i);

export default unparsed => {
    if (!unparsed) return [];

    const king = P.createLanguage({
        value: () =>
            P.alt(
                P.seqObj(ltag, ['tag', identifier], close, rtag),
                P.regexp(/[a-z0-9_<> /]+/i).map(text => ({
                    type: 'text',
                    text,
                })),
            ).many(),
    });
    return king.value.tryParse(unparsed);
};
