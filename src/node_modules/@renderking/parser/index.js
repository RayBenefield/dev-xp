import P from 'parsimmon';

const ltag = P.string('<');
const rtag = P.string('>');
const close = P.string('/');

const identifier = P.regexp(/[a-z_][a-z0-9_]*/i);

export default unparsed => {
    if (!unparsed) return [];

    const king = P.createLanguage({
        tag: () =>
            P.seqObj(ltag, ['tag', identifier], close, rtag).map(result => ({
                type: 'tag',
                ...result,
            })),
        string: () =>
            P.regexp(/[a-z0-9_<> /]+/i).map(text => ({
                type: 'text',
                text,
            })),
        value: r => P.alt(r.tag, r.string).many(),
    });

    return king.value.tryParse(unparsed);
};
