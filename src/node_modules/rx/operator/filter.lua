local operate = require('rx.operator')
local observer = require('rx.observer')

--TODO
-- Handle an index for every time the map is executed
return function(filter)
    return operate(function(source, destination)
        source.subscribe(
            observer(
                destination,
                function(...)
                    if (filter) then
                        if (filter(...)) then
                            destination.next(...)
                        end
                    else
                        destination.next(...)
                    end
                end
            )
        )
    end)
end
