local _ = require('ludash')
local operate = require('rx.operator')
local observer = require('rx.observer')

return function(keySelector)
    return operate(function(source, destination)
        local values = {}

        source.subscribe(
            observer(
                destination,
                function(value)
                    local key = _.isFunction(keySelector)
                        and keySelector(value)
                        or value

                    if not values[key] then
                        values[key] = true
                        destination.next(value)
                    end
                end
            )
        )
    end)
end
