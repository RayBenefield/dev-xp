local operate = require('rx.operator')
local observer = require('rx.observer')

return function(count)
    return operate(function(source, destination)
        if (not count) then
            return source.subscribe(destination)
        end

        local seen = 0
        local next

        if (count <= 0) then
            next = function()
                destination.complete()
            end
        else
            next = function(...)
                destination.next(...)
                seen = seen + 1

                if (seen >= count) then
                    destination.complete()
                end
            end
        end

        source.subscribe(observer(destination, next))
    end)
end
