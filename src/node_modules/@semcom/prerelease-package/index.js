import { resolve } from 'path'

import log from '@dev-xp/log'
import { write } from '@dev-xp/fs'
import { write as writeJson } from '@dev-xp/json'

const fixers = {
    'has readme file': ({ root, structure: { srcDir }, contents }) => {
        log('Creating [readme.md]...')
        return write(resolve(root, srcDir, 'readme.md'), contents)
    },
    'has a version number': ({ root, structure: { srcDir }, version }) => {
        log('Creating [package.json]...')
        return writeJson(resolve(root, srcDir, 'package.json'), { version })
    },
}

export default () => ({ root, structure, fixes }) =>
    Promise.all(
        Object.entries(fixes).map(([fix, details]) =>
            fixers[fix]({ root, structure, ...details })
        )
    )
