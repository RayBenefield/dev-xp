/* eslint-disable no-console */
import fs from 'fs'
import { resolve } from 'path'

import jsonFile from 'jsonfile'
import promisify from 'es6-promisify'

const writeFile = promisify(fs.writeFile)
const writeJson = promisify(jsonFile.writeFile)

const fixers = {
    'has readme file': ({ root, structure: { srcDir }, contents }) => {
        console.log('Creating [readme.md]...')
        return writeFile(resolve(root, srcDir, 'readme.md'), contents)
    },
}

export default () => ({ root, structure, fixes }) => {
    console.log('Creating [package.json]...')
    return Promise.all([
        ...Object.entries(fixes).map(([fix, details]) =>
            fixers[fix]({ root, structure, ...details })
        ),
        writeJson(
            resolve(root, structure.srcDir, 'package.json'),
            { version: '0.0.0' },
            { spaces: 4 }
        ),
    ])
}
