/* eslint-disable no-console */
import fs from 'fs'
import { resolve } from 'path'

import jsonFile from 'jsonfile'
import promisify from 'es6-promisify'

const writeFile = promisify(fs.writeFile)
const writeJson = promisify(jsonFile.writeFile)

const fixers = {
    'has readme file': ({ root, structure: { srcDir }, contents }) => {
        console.log('Creating [readme.md]...')
        return writeFile(resolve(root, srcDir, 'readme.md'), contents)
    },
    'has a version number': ({ root, structure: { srcDir }, version }) => {
        console.log('Creating [package.json]...')
        return writeJson(
            resolve(root, srcDir, 'package.json'),
            { version },
            { spaces: 4 }
        )
    },
}

export default () => ({ root, structure, fixes }) =>
    Promise.all(
        Object.entries(fixes).map(([fix, details]) =>
            fixers[fix]({ root, structure, ...details })
        )
    )
