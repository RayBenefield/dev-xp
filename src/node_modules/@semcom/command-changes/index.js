import transmute from 'transmutation';
import parseTags from '@semcom/parse-tags';
import gatherTags from '@semcom/tag-gatherer';
import template from '@semcom/template-changes';
import gatherChanges from '@kikd/change-gatherer';
import latestReleaseTag from '@kikd/latest-release-tag';

export default function changes() {
    return transmute({})
        .extend('rawTags', gatherTags)
        .extend('tags', parseTags)
        .extend('latest', latestReleaseTag)
        .extend('from', ({ latest }) => latest.tag)
        .extend('changes', gatherChanges);
}

export const command = {
    name: 'changes',
    aliases: ['changelog'],
    run: changes,
    template,
};
