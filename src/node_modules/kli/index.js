/* eslint-disable no-console */
import createSearcher from '@kli-tool/searcher';
import createExecutor from '@kli-tool/executor';
import prettyJson from 'jsome';

export const jsonRenderer = prettyJson;

const configureKli = ({ defaultStyle, defaultRenderer = console.log } = {}) => (
    { commands = [] } = {},
) => {
    if (!Array.isArray(commands)) throw new Error('Commands must be an array');
    if (commands.length === 0) throw new Error('No commands defined');

    commands.forEach(c => {
        if (typeof c.run !== 'function')
            throw new Error('All commands must have a run method');
    });

    if (commands.length === 1) return { execute: () => commands[0].run() };

    const searcher = createSearcher({ commands });
    const executor = createExecutor({ defaultStyle, defaultRenderer });

    return {
        execute: args => {
            const command = searcher.get(args[0])[0];
            const run = executor(command);
            return run();
        },
    };
};

export const configure = configureKli;
export const kli = configureKli({ defaultRenderer: console.log });

export default configureKli({ defaultRenderer: console.log });
