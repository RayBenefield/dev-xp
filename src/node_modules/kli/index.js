import log from '@dev-xp/log'
import keyBy from 'lodash.keyby'
import sanitizer from '@kli-tool/sanitizer'
import createDecider from '@kli-tool/decider'
import createExecutor from '@kli-tool/executor'

const configureKli = ({ style = {}, renderer = log } = {}) => ({
    default: proposedDefault,
    config = {},
    commands: rawCommands = [],
} = {}) => {
    sanitizer(rawCommands)
    const commands = keyBy(rawCommands, 'name')

    const decide = createDecider({ commands, proposedDefault, log: renderer })
    const execute = createExecutor({ config, style, renderer, decide })

    return { execute }
}

export const configure = configureKli
export const kli = configureKli()

export default configureKli()
