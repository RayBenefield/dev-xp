import keyBy from 'lodash.keyby'
import sanitizer from '@kli-tool/sanitizer'
import createDecider from '@kli-tool/decider'
import createExecutor from '@kli-tool/executor'

const configureKli = ({
    defaultStyle = {},
    defaultRenderer = console.log, // eslint-disable-line no-console
} = {}) => ({
    default: proposedDefault,
    config = {},
    commands: rawCommands = [],
    cleanse = {},
} = {}) => {
    sanitizer(rawCommands)
    const commands = keyBy(rawCommands, 'name')

    const decider = createDecider({ commands, proposedDefault })
    const execute = createExecutor({
        config,
        defaultStyle,
        defaultRenderer,
        decider,
        cleanse,
    })

    return { execute }
}

export const configure = configureKli
export const kli = configureKli()

export default configureKli()
