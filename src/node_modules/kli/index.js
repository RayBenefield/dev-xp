/* eslint-disable no-console */
import createSearcher from '@kli-tool/searcher'
import createExecutor from '@kli-tool/executor'

const configureKli = ({
    defaultStyle,
    defaultRenderer = console.log,
} = {}) => ({ config = {}, commands = [], cleanse = {} } = {}) => {
    if (!Array.isArray(commands)) throw new Error('Commands must be an array')
    if (commands.length === 0) throw new Error('No commands defined')

    commands.forEach(c => {
        if (typeof c.run !== 'function')
            throw new Error('All commands must have a run method')
    })

    const searcher = createSearcher({ commands })
    const execute = createExecutor({
        config,
        defaultStyle,
        defaultRenderer,
        searcher,
        cleanse,
        commands,
    })

    return { execute }
}

export const configure = configureKli
export const kli = configureKli({ defaultRenderer: console.log })

export default configureKli({ defaultRenderer: console.log })
