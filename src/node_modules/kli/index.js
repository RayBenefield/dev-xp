import createDecider from '@kli-tool/decider'
import createSearcher from '@kli-tool/searcher'
import createExecutor from '@kli-tool/executor'

const configureKli = ({
    defaultStyle = {},
    defaultRenderer = console.log, // eslint-disable-line no-console
} = {}) => ({
    default: proposedDefault,
    config = {},
    commands = [],
    cleanse = {},
} = {}) => {
    if (!Array.isArray(commands)) throw new Error('Commands must be an array')
    if (commands.length <= 0) throw new Error('No commands defined')

    commands.forEach(c => {
        if (typeof c.run !== 'function')
            throw new Error('All commands must have a run method')
    })

    const defaultCommand = proposedDefault || commands[0]

    const searcher = createSearcher({ commands })
    const decider = createDecider({ searcher })
    const execute = createExecutor({
        config,
        defaultStyle,
        defaultRenderer,
        defaultCommand,
        decider,
        cleanse,
    })

    return { execute }
}

export const configure = configureKli
export const kli = configureKli()

export default configureKli()
