import axios from 'axios'

export default ({ id, secret, callback, crypto: { encrypt } }) => {
    const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${id}&redirect_uri=${callback}&response_type=code`
    const accessUrl = `https://id.twitch.tv/oauth2/token?client_id=${id}&client_secret=${secret}&grant_type=authorization_code&redirect_uri=${callback}`
    return {
        getAuthUrl: ({ scopes = [], state = {} } = {}) => {
            const scopeStr = scopes.join('+')
            return `${authUrl}&scope=${scopeStr}&state=${encrypt(state)}`
        },
        getAccessToken: ({ code }) =>
            axios({ method: 'POST', url: `${accessUrl}&code=${code}` }).then(
                ({ data }) => data
            ),
    }
}
