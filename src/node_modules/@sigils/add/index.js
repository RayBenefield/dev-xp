import log from '@dev-xp/log'
import input from '@sigils/inputs'
import output from '@sigils/outputs'
import symbol from '@sigils/symbols'
import component from '@sigils/components'
import createRune from '@sigils/create-rune'

export default ({
    name = 'Add',
    a = 'Operand A',
    b = 'Operand B',
    result = 'Result',
} = {}) =>
    createRune({
        name,
        symbol: symbol.function,
        in: { a: input.number(a), b: input.number(b) },
        out: { result: output.number(result) },
        components: { preview: component.number(true) },
        magic: ({ rune, inputs, outputs, altar }) => {
            const first = inputs.a.length ? inputs.a[0] : rune.data.a || 0
            const second = inputs.b.length ? inputs.b[0] : rune.data.b || 0
            const finalResult = first + second

            altar.nodes
                .find(r => r.id === rune.id)
                .controls.get('preview')
                .setValue(finalResult)
            outputs.result = finalResult
        },
    })
