import { red } from 'chalk'
import createSearcher from '@kli-tool/searcher'

export default ({ proposedDefault, commands }) => {
    const commandArray = Object.values(commands)
    const onlyCommand = commandArray.length === 1 ? commandArray[0] : null
    const defaultCommand = proposedDefault || onlyCommand
    const searcher = createSearcher({ commands: commandArray })

    return request => {
        if (!request) return defaultCommand

        const results = searcher.get(request)
        if (results.length > 0) return results[0]

        if (defaultCommand) return defaultCommand

        // eslint-disable-next-line no-console
        console.log(red(`No command associated with \`${request}\``))
        return process.exit(127)
    }
}
