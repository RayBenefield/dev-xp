import { resolve } from 'path';
import describe from 'tape-bdd';
import withBlueTape from 'blue-tape';
import checkPackages from '@kikd/check-packages';

describe(
    'Check Packages',
    it => {
        it('should return empty results when no arguments are given', assert =>
            checkPackages().then(result => assert.deepEqual(result, [])));

        it('should return empty results with empty packages', assert =>
            checkPackages({ packages: [] }).then(result =>
                assert.deepEqual(result, []),
            ));

        it('should return a failing check for a package with no package.json', assert =>
            checkPackages({
                packages: [
                    {
                        dir: resolve(__dirname, 'fixtures/empty-dir'),
                    },
                ],
            }).then(result =>
                assert.deepEqual(result, [
                    {
                        dir: resolve(__dirname, 'fixtures/empty-dir'),
                        publishable: false,
                    },
                ]),
            ));
    },
    withBlueTape,
);
