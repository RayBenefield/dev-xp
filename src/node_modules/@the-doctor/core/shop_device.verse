
using. /Verse.org/Simulation
using. /Fortnite.com/Devices

using. Anima
using. TheDoctorAssets.Materials
using. Tableau
using. Vertex

shop_device<public> := class(tableau_device):
    @editable ResourceID<override>:string = "Shop"

    @editable ShopItem:?creative_prop = false

    GetResources<override>():[]resource= array:
        CreateSelectorResource("Item Selector", ItemTypes.Keys(), true)
        resource:
            ID := ResourceID
            Props := map:
                "Shop Item" => Str of Path("Item Selector", "Selection")
            Actions := map:
                "Prim Action" => Action of array:
                    IsFalse("Inventory", "Maxed")
                    Insert("Shop Item").To(Path("Inventory", "Items"))
                "Move Up" => Action of array:
                    Execute("Item Selector", "Next")
                "Move Down" => Action of array:
                    Execute("Item Selector", "Previous")
                "Move Right" => Action of array:
                    Execute("Section Selector", "Set Inventory")

    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        Mat := M_Item_material{}
        if (P := ShopItem?). P.SetMaterial(Mat)

        array:
            PushStr("Shop Item", SetTexture(ItemSetter(Mat).FN, ItemTypes, DefaultTexture).FN)
