
using. /Verse.org/Simulation
using. /Fortnite.com/Devices

using. Anima
using. TheDoctorAssets.Materials
using. Tableau
using. Vertex

shop_device<public> := class(creative_device, config_device, side_effect_device):
    @editable ShopItem:?creative_prop = false
    @editable ShopUpArrow:?creative_prop = false
    @editable ShopDownArrow:?creative_prop = false

    GetResources<override>():[]resource= array:
        CreateSelectorResource("Item Selector", ItemTypes.Keys())
        resource:
            ID := "Shop"
            Props := map:
                "Shop Label" => prop_str. Default := "Shop"
                "Inventory Label" => prop_str. Default := "Inventory"
                "In Shop" => Bool of (Path("Root", "Context"), "String Equals", Path("Shop Label"))
                "Shop Item" => prop_str. Focus := Path("Item Selector", "Selection")
            Actions := map:
                "Prim Action" => Action of array:
                    IsFalse("Inventory", "Maxed")
                    Insert("Shop Item").To(Path("Inventory", "Items"))
                "Move Up" => Action of array:
                    Execute("Item Selector", "Next")
                "Move Down" => Action of array:
                    Execute("Item Selector", "Previous")
                "Move Right" => Action of array:
                    Set("Root", "Context").To("Inventory Label")

    GetResourceID<override>()<computes>:?string= option. "Shop"
    GetPerType<override>()<computes>:?string= false
    GetPerSubType<override>()<computes>:?string= option. "Player"
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        PingPong(ShopUpArrow, array. Frame(MoveZBy(5.0)).SetTime(0.5))
        PingPong(ShopDownArrow, array. Frame(MoveZBy(-5.0)).SetTime(0.5))

        Mat := M_Item_material{}
        if (P := ShopItem?). P.SetMaterial(Mat)

        array:
            PushBool("In Shop", Toggle(ShopUpArrow).FN)
            PushBool("In Shop", Toggle(ShopDownArrow).FN)
            PushStr("Shop Item", SetTexture(ItemSetter(Mat).FN, ItemTypes, DefaultTexture).FN)
            # Debug("Shop Item", "Shop Item")
