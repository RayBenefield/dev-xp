
using. /Verse.org/Assets
using. /Verse.org/Random
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /Fortnite.com/Devices/CreativeAnimation
using. /UnrealEngine.com/Temporary/SpatialMath
using. /Fortnite.com/Devices/CreativeAnimation/InterpolationTypes

using. Tableau
using. TableauDevice
using. TableauEffect
using. TableauLogic
using. TableauResource
using. Vertex

heroes_device<public> := class(creative_device, config_device, side_effect_device):
    @editable TargetCursor:creative_prop = creative_prop{}
    @editable TargetCursorSettings:cursor_settings = cursor_settings{}

    GetResources<override>():[]resource= array:
        resource:
            ID := "Heroes"
            Props := map:
                "ONE" => prop_int. Default := 1
                "Hero Label" => prop_str. Default := "Hero"
                "All Hero Types" => prop_strs. Default := HeroTypes.Keys()
                "Heroes" => prop_strs{}
                "Hero Count" => prop_int{ Focus := Path("Heroes"), FN := "Length" }
                "Next Hero Number" => prop_int{ Focus := Path("Hero Count"), FN := "+", Tweak := Path("ONE") }
                "Next Hero ID" => prop_str{ Focus := Path("Hero Label"), FN := "Append", Tweak := Path("Next Hero Number") }
                "Last Hero" => prop_str{ Focus := Path("Heroes"), FN := "Get", Tweak := Path("Hero Count") }
            Abilities := map:
                "Add Random Hero" => ability. Effects := array:
                    Create("Next Hero ID").As("Hero Label")
                    Insert("Next Hero ID").Into("Heroes")
        resource:
            Type := "Hero"
            Props := map:
                "Hero Type" => prop_str{ Focus := Path("Heroes", "All Hero Types"), FN := "Random" }
        CreateCursorResource(TargetCursorSettings)
        resource:
            ID := "Targets"
            Props := map:
                "Target Label" => prop_str. Default := "Targets"
                "Inventory Label" => prop_str. Default := "Inventory"
                "In Targets" => prop_bool{ Focus := Path("Root", "Context"), FN := "String Equals", Tweak := Path("Target Label") }
                "Target Location" => prop_vec3. Focus := Path("Target Cursor", "Location")
            Abilities := map:
                "Action" => ability. Effects := array:
                    Execute("Inventory", "Use Item")
                    Set("Root", "Context").To("Inventory Label")
                "Move Up" => ability. Effects := array:
                    Execute(TargetCursorSettings.ID, "Decrease Y")
                "Move Down" => ability. Effects := array:
                    Execute(TargetCursorSettings.ID, "Increase Y")
                "Move Right" => ability. Effects := array:
                    Execute(TargetCursorSettings.ID, "Increase X")
                "Move Left" => ability. Effects := array:
                    Execute(TargetCursorSettings.ID, "Decrease X")

    GetResourceID<override>()<computes>:?string= option. "Targets"
    GetPerType<override>()<computes>:?string= false
    GetPerSubType<override>()<computes>:?string= false
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        array:
            toggle_prop{ PropertyID := "In Targets", Prop := TargetCursorSettings.Prop }
            move{ PropertyID := "Target Location", Prop := TargetCursorSettings.Prop, Time := 0.1 }
            Debug("Target Location")
            # Debug("Hero Count")
            # Debug("Next Hero ID")
