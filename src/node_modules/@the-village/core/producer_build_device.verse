
using { /Verse.org/Assets }
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }
using { /UnrealEngine.com/Assets }
using { /Fortnite.com/Devices/CreativeAnimation }
using { /UnrealEngine.com/Temporary/SpatialMath }

using { Tableau }

spawn_vfx_fn := class():
    VFX:particle_system
    Position:vector3
    FN<public>():void= SpawnParticleSystem(VFX, Position)

producer_build_device<public> := class(creative_device, tableau_device):
    @editable ResourceID:string = ""
    @editable PropertyID:string = ""
    @editable GuardPropertyID:?string = false
    @editable RefPosition:creative_prop = creative_prop{}
    VFX:particle_system = TycoonPack.Particles.Smoke.P_Building

    Init<override>(GameState:game_state)<suspends>:void=
        Watcher := participant_watcher{ GameState := GameState, OnPossessed := HandleVFX }
        spawn. Watcher.Start()

    HandleVFX(GameState:game_state, ParticipantID:string, Agent:agent)<suspends>:void=
        if (Guard := GuardPropertyID?). GameState.AfterTrue(ResourceID, Guard, ParticipantID)

        SpawnVFX := spawn_vfx_fn{ VFX := VFX, Position := RefPosition.GetTransform().Translation }
        GameState.OnUpdated(ResourceID, PropertyID, ParticipantID, SpawnVFX.FN)
