
using { /Verse.org/Assets }
using { /Fortnite.com/Devices }
using { /Verse.org/Simulation }

using { Tableau }

show_prop_fn := class():
    Prop:creative_prop
    FN<public>():void= Prop.Show()

set_material_fn := class():
    Prop:creative_prop
    Material:material
    FN<public>():void= Prop.SetMaterial(Material)

producer_visuals_device<public> := class(creative_device, tableau_device):
    @editable ResourceID:string = ""
    @editable ShowPropertyID:string = ""
    @editable SolidifyPropertyID:string = ""
    @editable Prop:creative_prop = creative_prop{}
    Hologram:material = TableauAssets.MI_BlueHologram
    Summer:material = ResizedKayKitMedieval.Materials.MI_Summer

    Init<override>(GameState:game_state)<suspends>:void=
        Prop.Hide()
        Prop.SetMaterial(Hologram)
        Watcher := participant_watcher{ GameState := GameState, OnPossessed := HandleProp }
        spawn. Watcher.Start()

    HandleProp(GameState:game_state, ParticipantID:string, Agent:agent)<suspends>:void=
        ShowProp := show_prop_fn. Prop := Prop
        GameState.WhenTrue(ResourceID, ShowPropertyID, ParticipantID, ShowProp.FN)
        SetSummer := set_material_fn{ Prop := Prop, Material := Summer }
        GameState.WhenTrue(ResourceID, SolidifyPropertyID, ParticipantID, SetSummer.FN)
