
using. /Verse.org/Simulation

using. Numb
using. Tableau
using. TableauResource

producer_settings<public> := class<concrete>():
    @editable ID:string = ""
    @editable Tier:int = 0
    @editable CostResource:string = ""
    @editable ProduceResource:string = ""
    @editable BaseCost:float = 3.738
    @editable CostGrowth:float = 1.07
    @editable ProductionRate:float = 0.6
    @editable Production:float = 1.67
    @editable HireCost:num = num. Value := 1000.0

CreateProducerResource<public><constructor>(P:producer_settings) := resource:
    ID := P.ID
    Type := "Producer"
    Props := map:
        "Name" => prop_str. Default := P.ID
        "Cost Growth" => prop_float. Default := P.CostGrowth
        "Base Cost" => prop_float. Default := P.BaseCost
        "Production Rate" => prop_float. Default := P.ProductionRate
        "Hire Cost" => prop_num. Default := P.HireCost
        "Tier" => prop_float. Default := P.Tier * 1.0
        "Working" => prop_bool. Default := false
        "ZERO" => prop_float. Default := 0.0
        "ONE" => prop_float. Default := 1.0
        "Count" => prop_num{}
        "Workers" => prop_num{}
        "Produced Count" => prop_num{}
        "Start Produced Count" => prop_num{}
        "Production" => prop_float. Default := P.Production
        "Exists" => prop_bool{ Focus := Path("Can Afford"), FN := "OR", Pay := Load(Path("Has Some")) }
        "Production Amount" => prop_num{ Focus := Path("Count"), FN := "Multiply", Pay := Load(Path("Production")) }
        "Cost Rate" => prop_num{ Focus := Path("Cost Growth"), FN := "Power", Pay := Load(Path("Count")) }
        "Cost" => prop_num{ Focus := Path("Cost Rate"), FN := "Multiply", Pay := Load(Path("Base Cost")) }
        "Can Afford" => prop_bool{ Focus := Path(P.CostResource, "Count"), FN := ">=", Pay := Load(Path("Cost")) }
        "Can Hire" => prop_bool{ Focus := Path(P.CostResource, "Count"), FN := ">=", Pay := Load(Path("Hire Cost")) }
        "Has One" => prop_bool{ Focus := Path("Count"), FN := "=", Pay := Load(Path("ONE")) }
        "Has Some" => prop_bool{ Focus := Path("Count"), FN := ">=", Pay := Load(Path("ONE")) }
        "Has Workers" => prop_bool{ Focus := Path("Workers"), FN := ">=", Pay := Load(Path("ONE")) }
        "No Workers" => prop_bool{ Focus := Path("Workers"), FN := "=", Pay := Load(Path("ZERO")) }
        "Hireable" => prop_bool{ Focus := Path("No Workers"), FN := "AND", Pay := Load(Path("Can Hire")) }
        "Can Work" => prop_bool{ Focus := Path("Has Some"), FN := "AND", Pay := Load(Path("No Workers")) }
        "Not Working" => prop_bool{ Focus := Path("Working"), FN := "NOT" }
    Abilities := map:
        "Buy" => array:
            effect{ FN := "Is True", Focus := Path("Can Afford") }
            effect{ FN := "Decrease", Focus := Path(P.CostResource, "Count"), Pay := Load(Path("Cost")) }
            effect{ FN := "Increase", Focus := Path("Count"), Pay := Load(Path("ONE")) }
            effect{ FN := "Is True", Focus := Path("Has One") }
            effect{ FN := "Is True", Focus := Path("Has Workers") }
            effect{ FN := "Execute Ability", Focus := Path("Produce") }
        "Produce" => array:
            effect{ FN := "Is True", Focus := Path("Has Some") }
            effect{ FN := "Is False", Focus := Path("Working") }
            effect{ FN := "Make True", Focus := Path("Working") }
            effect{ FN := "Increase", Focus := Path("Start Produced Count"), Pay := Load(Path("ONE")) }
            effect{ FN := "Delay", Focus := Path("Production Rate") }
            effect{ FN := "Increase", Focus := Path(P.ProduceResource, "Count"), Pay := Load(Path("Production Amount")) }
            effect{ FN := "Increase", Focus := Path("Produced Count"), Pay := Load(Path("ONE")) }
            effect{ FN := "Make False", Focus := Path("Working") }
            effect{ FN := "Is True", Focus := Path("Has Workers") }
            effect{ FN := "Execute Ability", Focus := Path("Produce") }
        "Hire" => array:
            effect{ FN := "Is False", Focus := Path("Has Workers") }
            effect{ FN := "Is True", Focus := Path("Can Hire") }
            effect{ FN := "Decrease", Focus := Path(P.CostResource, "Count"), Pay := Load(Path("Hire Cost")) }
            effect{ FN := "Increase", Focus := Path("Workers"), Pay := Load(Path("ONE")) }
            effect{ FN := "Is True", Focus := Path("Has Some") }
            effect{ FN := "Execute Ability", Focus := Path("Produce") }
