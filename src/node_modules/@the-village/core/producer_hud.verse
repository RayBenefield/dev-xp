
using. /Fortnite.com/UI
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/UI

using. Goo
using. Gooey
using. Vertex
using. Tableau

producer_pos_hud_device<public> := class(creative_device, tableau_device):
    @editable ResourceID:string = ""
    @editable HUDSettings:canvas_settings = canvas_settings{}

    CostMsg(Cost:string):string:= "Cost: {Cost}"
    CountMsg(Count:string):string := "Count: {Count}"
    ProdMsg(Amount:string):string := "Profit: {Amount}"

    Init<override>(GameState:game_state)<suspends>:void=
        GameState.AddHUD("Producer POS HUD", SetupHUD, HUDSettings, ?Clickable := true)

    SetupHUD(GameState:game_state, PlayerID:string):widget=
        LeftHUD:logic := if (HUDSettings.Offsets.HorizontalPadding >= 0.0). true else. false
        LeftPad := margin{ Left := 0.0, Top := 0.0, Right := 8.0, Bottom := 8.0 }
        RightPad := margin{ Left := 8.0, Top := 0.0, Right := 0.0, Bottom := 8.0 }

        Buttons := array:
            gooey_button:
                DefaultText := "Work"
                Button := button_loud{}
                VisibleGoo := GameState.GetBoolProp(ResourceID, "Can Work", PlayerID)
                EnabledGoo := GameState.GetBoolProp(ResourceID, "Not Working", PlayerID)
                Action := GameState.GetAbility(ResourceID, "Produce", PlayerID)
            gooey_button:
                DefaultText := "Buy"
                EnabledGoo := GameState.GetBoolProp(ResourceID, "Can Afford", PlayerID)
                Action := GameState.GetAbility(ResourceID, "Buy", PlayerID)
            gooey_button:
                DefaultText := "Hire"
                Button := button_loud{}
                VisibleGoo := GameState.GetBoolProp(ResourceID, "Hireable", PlayerID)
                Action := GameState.GetAbility(ResourceID, "Hire", PlayerID)
        OrderedButtons := if (LeftHUD?). Buttons else. Buttons.Reverse()

        Count := string_goo. VM := Map(GameState.GetStrProp(ResourceID, "Count", PlayerID), CountMsg)
        Cost := string_goo. VM := Map(GameState.GetStrProp(ResourceID, "Cost", PlayerID), CostMsg)
        Prod := string_goo. VM := Map(GameState.GetStrProp(ResourceID, "Production Amount", PlayerID), ProdMsg)
        Widgets := array:
            gooey_stack_box:
                Widgets := for(Button:OrderedButtons). Button.Initialize()
                Orientation := orientation.Horizontal
                Padding := if (LeftHUD?). LeftPad else. RightPad
            gooey_text_block. TextGoo := GameState.GetStrProp(ResourceID, "Name", PlayerID)
            gooey_text_block. TextGoo := Cost
            gooey_text_block. TextGoo := Count
            gooey_text_block. TextGoo := Prod

        HUD := gooey_stack_box:
            Orientation := orientation.Vertical
            Widgets := for(Widget:Widgets). Widget.Initialize()
            HorizAlign := if (LeftHUD?). horizontal_alignment.Left else. horizontal_alignment.Right
        HUD.Initialize()
