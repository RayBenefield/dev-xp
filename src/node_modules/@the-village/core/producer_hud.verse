
using. /Fortnite.com/UI
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/UI

using. Goo
using. Gooey
using. Vertex
using. Tableau
using. TableauDevice

SetVisibility<constructor>(Button:text_button_base) := set_visibility. Button := Button
set_visibility := class():
    Button:text_button_base
    FN<public>(Value:logic):void=
        Visibility := if (Value?). widget_visibility.Visible else. widget_visibility.Collapsed
        Button.SetVisibility(Visibility)

producer_pos_hud_device<public> := class(creative_device, side_effect_device):
    @editable ResourceID:string = ""
    @editable HUDSettings:canvas_settings = canvas_settings{}

    CostMsg(Cost:string):string:= "Cost: {Cost}"
    CountMsg(Count:string):string := "Count: {Count}"
    ProdMsg(Amount:string):string := "Profit: {Amount}"

    GetResourceID<override>()<computes>:?string= option. ResourceID
    GetPerType<override>()<computes>:?string= false
    GetPerSubType<override>()<computes>:?string= option. "Player"
    GetSideEffects<override>(GameState:game_state, TypeID:string, PlayerID:string)<suspends>:[]side_effect=
        LeftHUD:logic := if (HUDSettings.HorizontalPadding >= 0.0). true else. false
        LeftPad := margin{ Left := 0.0, Top := 0.0, Right := 8.0, Bottom := 8.0 }
        RightPad := margin{ Left := 8.0, Top := 0.0, Right := 0.0, Bottom := 8.0 }

        WorkAction := GameState.GetAbilityExec(ResourceID, "Produce", PlayerID)
        WorkButton := LoudButton("Work", WorkAction)
        BuyAction := GameState.GetAbilityExec(ResourceID, "Buy", PlayerID)
        BuyButton := RegularButton("Buy", BuyAction)
        HireAction := GameState.GetAbilityExec(ResourceID, "Hire", PlayerID)
        HireButton := LoudButton("Hire", HireAction)
        ActualButtons := array:
            WorkButton
            BuyButton
            HireButton
        OrderedButtons := if (LeftHUD?). ActualButtons else. ActualButtons.Reverse()

        NameText := WhiteText()
        CostText := WhiteText()
        CountText := WhiteText()
        ProdText := WhiteText()

        Widgets := array:
            stack_box:
                Slots := for(Widget:OrderedButtons). stack_box_slot:
                    Widget := Widget
                    Padding := if (LeftHUD?). LeftPad else. RightPad
                Orientation := orientation.Horizontal
            NameText
            CostText
            CountText
            ProdText

        HUD := stack_box:
            Orientation := orientation.Vertical
            Slots := for(Widget:Widgets):
                stack_box_slot:
                    Widget := Widget
                    HorizontalAlignment := if (LeftHUD?). horizontal_alignment.Left else. horizontal_alignment.Right

        GameState.AddUI(HUD, PlayerID, HUDSettings)

        array:
            PushToMsg(Path("Name"), NameText.SetText)
            PushToMsg(Path("Cost"), CostMsg, CostText.SetText)
            PushToMsg(Path("Count"), CountMsg, CountText.SetText)
            PushToMsg(Path("Production Amount"), ProdMsg, ProdText.SetText)
            PushBool(Path("Can Work"), SetVisibility(WorkButton).FN)
            PushBool(Path("Not Working"), WorkButton.SetEnabled)
            PushBool(Path("Can Afford"), BuyButton.SetEnabled)
            PushBool(Path("Hireable"), SetVisibility(HireButton).FN)
