
using. /Fortnite.com/UI
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/UI

using. Goo
using. Gooey
using. Vertex
using. Tableau
using. TableauDevice

producer_pos_hud_device<public> := class(creative_device, side_effect_device):
    @editable ResourceID:string = ""
    @editable HUDSettings:canvas_settings = canvas_settings{}

    CostMsg(Cost:string):string:= "Cost: {Cost}"
    CountMsg(Count:string):string := "Count: {Count}"
    ProdMsg(Amount:string):string := "Profit: {Amount}"

    GetResourceID<override>()<computes>:?string= option. ResourceID
    GetPerType<override>()<computes>:?string= false
    GetPerSubType<override>()<computes>:?string= option. "Player"
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        LeftHUD:logic := if (HUDSettings.HorizontalPadding >= 0.0). true else. false
        LeftPad := margin{ Left := 0.0, Top := 0.0, Right := 8.0, Bottom := 8.0 }
        RightPad := margin{ Left := 8.0, Top := 0.0, Right := 0.0, Bottom := 8.0 }

        WorkButton := LoudButton("Work")
        BuyButton := RegularButton("Buy")
        HireButton := LoudButton("Hire")
        State.AttachAction("Produce", WorkButton.OnClick())
        State.AttachAction("Buy", BuyButton.OnClick())
        State.AttachAction("Hire", HireButton.OnClick())
        ActualButtons := array{ WorkButton, BuyButton, HireButton }
        OrderedButtons := if (LeftHUD?). ActualButtons else. ActualButtons.Reverse()

        NameText := WhiteText()
        CostText := WhiteText()
        CountText := WhiteText()
        ProdText := WhiteText()

        Widgets := array:
            stack_box:
                Slots := for(Widget:OrderedButtons). stack_box_slot:
                    Widget := Widget
                    Padding := if (LeftHUD?). LeftPad else. RightPad
                Orientation := orientation.Horizontal
            NameText
            CostText
            CountText
            ProdText

        HUD := stack_box:
            Orientation := orientation.Vertical
            Slots := for(Widget:Widgets):
                stack_box_slot:
                    Widget := Widget
                    HorizontalAlignment := if (LeftHUD?). horizontal_alignment.Left else. horizontal_alignment.Right

        State.GameState.AddUI(HUD, State.PlayerID, HUDSettings)

        array:
            PushToMsg("Name", NameText.SetText)
            PushToMsg("Cost", CostMsg, CostText.SetText)
            PushToMsg("Count", CountMsg, CountText.SetText)
            PushToMsg("Production Amount", ProdMsg, ProdText.SetText)
            PushBool("Can Work", SetVisibility(WorkButton).FN)
            PushBool("Not Working", SetEnabled(WorkButton).FN)
            PushBool("Can Afford", SetEnabled(BuyButton).FN)
            PushBool("Hireable", SetVisibility(HireButton).FN)
