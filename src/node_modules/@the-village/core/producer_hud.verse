
using. /Fortnite.com/UI
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/UI

using. Goo
using. Gooey
using. Vertex
using. Tableau

producer_pos_hud_device<public> := class(tableau_device):
    @editable ResourceID<override>:string = "Producer"
    @editable HUDSettings:canvas_settings = canvas_settings{}

    CostMsg(Cost:string):string:= "Cost: {Cost}"
    CountMsg(Count:string):string := "Count: {Count}"
    ProdMsg(Amount:string):string := "Profit: {Amount}"

    GetResources<override>():[]resource= array. resource:
        Props := map:
            "Cost Prefix" => Str of "Cost: "
            # "Cost Msg" => Msg of (CostMsg, "Cost")
            "Cost Msg" => Str of (Path("Cost Prefix"), "Append", Path("Cost"))
            "Count Prefix" => Str of "Count: "
            "Count Msg" => Str of (Path("Count Prefix"), "Append", Path("Count"))
            "Profit Prefix" => Str of "Profit: "
            "Profit Msg" => Str of (Path("Profit Prefix"), "Append", Path("Production Amount"))

    GetSideEffects<override>()<suspends>:[]side_effect=
        LeftHUD:logic := if (HUDSettings.HorizontalPadding >= 0.0). true else. false
        LeftPad := margin{ Left := 0.0, Top := 0.0, Right := 8.0, Bottom := 8.0 }
        RightPad := margin{ Left := 8.0, Top := 0.0, Right := 0.0, Bottom := 8.0 }

        WorkButton := LoudButton("Work")
        BuyButton := RegularButton("Buy")
        HireButton := LoudButton("Hire")
        ActualButtons := array{ WorkButton, BuyButton, HireButton }
        OrderedButtons := if (LeftHUD?). ActualButtons else. ActualButtons.Reverse()

        NameText := WhiteText()
        CostText := WhiteText()
        CountText := WhiteText()
        ProdText := WhiteText()

        Widgets := array:
            stack_box:
                Slots := for(Widget:OrderedButtons). stack_box_slot:
                    Widget := Widget
                    Padding := if (LeftHUD?). LeftPad else. RightPad
                Orientation := orientation.Horizontal
            NameText
            CostText
            CountText
            ProdText

        HUD := stack_box:
            Orientation := orientation.Vertical
            Slots := for(Widget:Widgets):
                stack_box_slot:
                    Widget := Widget
                    HorizontalAlignment := if (LeftHUD?). horizontal_alignment.Left else. horizontal_alignment.Right

        array:
            BindWidget(HUD, HUDSettings)
            Attach("Produce", WorkButton.OnClick())
            Attach("Buy", BuyButton.OnClick())
            Attach("Hire", HireButton.OnClick())
            PushMsg("ID", SetText(NameText).FN)
            PushMsg("Cost Msg", SetText(CostText).FN)
            PushMsg("Count Msg", SetText(CountText).FN)
            PushMsg("Profit Msg", SetText(ProdText).FN)
            PushBool("Can Work", SetVisibility(WorkButton).FN)
            PushBool("Not Working", SetEnabled(WorkButton).FN)
            PushBool("Can Afford", SetEnabled(BuyButton).FN)
            PushBool("Hireable", SetVisibility(HireButton).FN)
