
using. /Verse.org/Assets
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /Fortnite.com/Devices/CreativeAnimation
using. /UnrealEngine.com/Temporary/SpatialMath
using. /Fortnite.com/Devices/CreativeAnimation/InterpolationTypes

using. Anima
using. Tableau
using. Vertex

BarAnim(Duration:float):[]frame = array:
    Frame(ScaleXTo(1.0))
    Frame(ScaleXTo(2.0)).SetTime(Duration)
    Frame(ScaleXTo(-1.0))

BuildAnim():[]frame = array:
    Frame(MoveZBy(-100.0), RotateYawBy(180.0), ScaleBy(0.1))
    Frame(MoveZBy(100.0), RotateYawBy(-180.0), ScaleBy(10.0)).SetTime(0.5).SetEasing(EaseOut)
    Frame(ScaleBy(0.5)).SetTime(0.1).SetEasing(EaseIn)
    Frame(ScaleBy(2.0)).SetTime(0.1).SetEasing(EaseOut)

producer_device<public> := class(tableau_device):
    @editable ResourceID<override>:string = "Producer"
    @editable Settings<public>:producer_settings = producer_settings{}
    GetResources<override>():[]resource= array. CreateProducerResource(ResourceID, Settings)

    @editable Building:?creative_prop = false
    @editable BarProp:creative_prop_asset = DefaultCreativePropAsset

    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        Loc := GetTransform().Translation
        Bar := Spawn(BarProp, Loc, S3(-1.0))

        SetupOneShot(Building, BuildAnim())

        array:
            Push("Start Produced Count", PlayAnim(Bar).FN)
            Push("Has Some", PlayAnim(Building).FN)
            PushFloat("Production Rate", UpdateAnimWithFloat(Bar, BarAnim).FN)
