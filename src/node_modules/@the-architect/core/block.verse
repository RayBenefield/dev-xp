
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/SpatialMath

using. Tableau
using. TableauDevice
using. TableauEffect
using. TableauResource
using. Vertex

place_block_fn := class():
    Prop:creative_prop_asset
    FN<public>(Position:vector3):void= SpawnProp(Prop, Position, IdentityRotation())

block_type_entry := class<public><concrete>():
    @editable Type<public>:string = ""
    @editable Prop<public>:creative_prop_asset = DefaultCreativePropAsset

AddEntry(Entry:block_type_entry, All:[string]creative_prop_asset)<transacts>:[string]creative_prop_asset=
    var NewEntry:[string]creative_prop_asset = map{}
    if. set NewEntry[Entry.Type] = Entry.Prop
    ConcatenateMaps(All, NewEntry)

block_device<public> := class(creative_device, config_device, side_effect_device):
    @editable TypeID:string = "Block"
    @editable DefaultBlock:creative_prop_asset = DefaultCreativePropAsset
    @editable BlockTypes:[]block_type_entry = array{}

    GetResources<override>():[]resource= array:
        resource:
            Type := TypeID
            Props := map:
                "Exists" => prop_bool. Default := true
                "Location" => prop_vec3. DefaultFrom := option. Path("Architect Cursor", "Location")
                "Block Type" => prop_str. DefaultFrom := option. Path("Architect Cursor", "Block Type")

    GetResourceID<override>()<computes>:?string= false
    GetPerType<override>()<computes>:?string= option. TypeID
    GetPerSubType<override>()<computes>:?string= false
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        StartingBlockMap:[string]creative_prop_asset = map{}
        BlockMap := BlockTypes.Reduce(AddEntry, StartingBlockMap)
        BlockType := State.GetStr("Block Type").Get()
        PlaceBlock := place_block_fn. Prop := BlockMap[BlockType] or DefaultBlock
        array:
            PushVec3("Location", PlaceBlock.FN)

