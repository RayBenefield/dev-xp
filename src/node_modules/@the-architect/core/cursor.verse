
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/SpatialMath

using. Banding
using. Gooey
using. Tableau

architect_cursor_device<public> := class(creative_device, config_device, side_effect_device):
    @editable ResourceID:string = "Architect Cursor"
    @editable CursorSettings:cursor_settings = cursor_settings{}

    @editable TypeHUDSettings:canvas_settings = canvas_settings{}
    @editable BlockHUDSettings:canvas_settings = canvas_settings{}

    GetResources<override>():[]resource= array:
        CreateCursorResource(CursorSettings)
        resource:
            ID := ResourceID
            Props := map:
                "Column Label" => prop_str. Default := "Column"
                "Selector Label" => prop_str. Default := " Selector"
                "Height" => prop_int{ Focus := Path(Path("Column ID"), "Height"), FN := "+", Tweak := ONE() }
                "Height Increment" => prop_float. Default := 64.0
                "Column ID" => prop_str{ Focus := Path("Column Label"), FN := "Append", Tweak := Path("Cursor", "Location ID") }
                "Z Coord" => prop_float{ Focus := Path("Height"), FN := "*", Tweak := Path("Height Increment")}
                "Location" => prop_vec3{ Focus := Path("Cursor", "XY Location"), FN := "Append", Tweak := Path("Z Coord") }
                "Column Exists" => Bool of Path(Path("Column ID"), "Exists")
                "Current Type" => prop_str{ Focus := Path("Type Selector", "Selection") }
                "Current Selector" => prop_str{ Focus := Path("Current Type"), FN := "Append", Tweak := Path("Selector Label") }
                "Block Type" => prop_str{ Focus := Path(Path("Current Selector"), "Selection") }
            Abilities := map:
                "Prim Action" => Action of array:
                    IsTrue("Column Exists").Else("Create Column")
                    Execute(Path("Column ID"), "Add Block")
                "Create Column" => Action of array:
                    Create("Column ID").As("Column Label")
                    Execute(Path("Column ID"), "Add Block")
                "Alt Action" => Action of array:
                    Execute(Path("Current Selector"), "Next")
                "Util Action" => Action of array:
                    Execute("Type Selector", "Next")
                "Move Right" => Action of array:
                    Execute(CursorSettings.ID, "Increase X")
                "Move Left" => Action of array:
                    Execute(CursorSettings.ID, "Decrease X")
                "Move Up" => Action of array:
                    Execute(CursorSettings.ID, "Increase Y")
                "Move Down" => Action of array:
                    Execute(CursorSettings.ID, "Decrease Y")

    GetResourceID<override>()<computes>:?string= option. ResourceID
    GetPerType<override>()<computes>:?string= false
    GetPerSubType<override>()<computes>:?string= option. "Player"
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        Sleep(0.1)
        BlockWidget := WhiteText()
        State.GameState.AddUI(BlockWidget, "Player1", BlockHUDSettings)
        TypeWidget := WhiteText()
        State.GameState.AddUI(TypeWidget, "Player1", TypeHUDSettings)

        array:
            PushMsg("Current Type", Prefixer("Type: ").FN, SetText(TypeWidget).FN)
            PushMsg("Block Type", Prefixer("Block: ").FN, SetText(BlockWidget).FN)
            PushVec3("Location", Move(CursorSettings.Prop, 0.2).FN)
            # Debug("Column ID", "Column ID")
            # Debug("Block ID", "Block ID")
