
using. /Fortnite.com/Devices
using. /Verse.org/Simulation
using. /UnrealEngine.com/Temporary/SpatialMath

using. Tableau
using. TableauDevice
using. TableauEffect
using. TableauResource

architect_cursor_device<public> := class(creative_device, config_device, side_effect_device):
    @editable ResourceID:string = "Architect Cursor"

    @editable Cursor:creative_prop = creative_prop{}
    @editable Place:input_trigger_device = input_trigger_device{}

    GetResources<override>():[]resource= array:
        resource:
            ID := ResourceID
            Props := map:
                "ONE" => prop_int. Default := 1
                "COMMA" => prop_str. Default := ","
                "SNOW" => prop_str. Default := "Snow"
                "GRASS" => prop_str. Default := "Grass"
                "Column Label" => prop_str. Default := "Column"
                "Block Label" => prop_str. Default := "Block"
                "Height" => prop_int{ Focus := Path(Path("Column ID"), "Height") }
                "Height Increment" => prop_float. Default := 64.0
                "Column ID" => prop_str{ Focus := Path("Column Label"), FN := "Append", Tweak := Path("Cursor", "Location ID") }
                "Partial Location ID" => prop_str{ Focus := Path("Cursor", "Location ID"), FN := "Append", Tweak := Path("COMMA") }
                "Location ID" => prop_str{ Focus := Path("Partial Location ID"), FN := "Append", Tweak := Path("Height") }
                "Block ID" => prop_str{ Focus := Path("Block Label"), FN := "Append", Tweak := Path("Location ID") }
                "Z Coord" => prop_float{ Focus := Path("Height"), FN := "*", Tweak := Path("Height Increment")}
                "Location" => prop_vec3{ Focus := Path("Cursor", "XY Location"), FN := "Append", Tweak := Path("Z Coord") }
                "Column Exists" => prop_bool{ Focus := Path(Path("Column ID"), "Exists") }
                "Block Exists" => prop_bool{ Focus := Path(Path("Block ID"), "Exists") }
                "Block Type" => prop_str. Default := "Grass"
                "Next Type" => prop_str. Default := "Snow"
                "Is Grass" => prop_bool{ Focus := Path("Block Type"), FN := "String Equals", Tweak := Path("GRASS") }
                "Is Snow" => prop_bool{ Focus := Path("Block Type"), FN := "String Equals", Tweak := Path("SNOW") }
            Abilities := map:
                "Add Block" => ability. Effects := array:
                    Execute("Try Add Column")
                    Execute("Try Add Block")
                "Try Add Column" => ability. Effects := array:
                    IsFalse("Column Exists")
                    Create("Column ID").As("Column Label")
                "Try Add Block" => ability. Effects := array:
                    IsFalse("Block Exists")
                    Create("Block ID").As("Block Label")
                    Execute(Path("Column ID"), "Increase Height")
                    Execute("Toggle Type")
                "Toggle Type" => ability. Effects := array:
                    Execute("Try Snow")
                    Execute("Try Grass")
                    Set("Block Type").To("Next Type")
                "Try Snow" => ability. Effects := array:
                    IsTrue("Is Grass")
                    Set("Next Type").To("SNOW")
                "Try Grass" => ability. Effects := array:
                    IsTrue("Is Snow")
                    Set("Next Type").To("GRASS")

    GetResourceID<override>()<computes>:?string= option. ResourceID
    GetPerType<override>()<computes>:?string= false
    GetPerSubType<override>()<computes>:?string= false
    GetSideEffects<override>(State:scoped_state)<suspends>:[]side_effect=
        State.AttachAction("Add Block", Place.ReleasedEvent)

        array:
            move{ PropertyID := "Location", Prop := option. Cursor, Time := 0.2 }
            Debug("Is Grass", "Is Grass")
            Debug("Is Snow", "Is Snow")
            Debug("Block Type", "Cursor Block Type")
            Debug("Next Type", "Cursor Next Type")
            # Debug("Column ID", "Column ID")
            # Debug("Block ID", "Block ID")
