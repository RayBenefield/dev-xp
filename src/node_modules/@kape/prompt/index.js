import readline from 'readline'

import log from '@dev-xp/log'
import { white, red } from 'chalk'
import attempt from 'promise-retry'

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
})

const prompt = ({ message, default: def }) =>
    new Promise(res => {
        rl.resume()
        rl.question(
            `${white.bold(message)} ${white(`[${def ? 'Y/n' : 'y/N'}] `)}`,
            answer => {
                rl.pause()
                return res(answer)
            }
        )
    })

export default (...args) =>
    attempt(retry =>
        prompt(...args).then(answer => {
            const sanitized = answer.length <= 0 ? 'n' : answer.toLowerCase()
            if (sanitized !== 'y' && sanitized !== 'n') {
                log(red('That is not a `y` or `n`...'))
                return retry()
            }
            return sanitized
        })
    )
