import argv from 'argv'
import { cosmiconfig } from 'cosmiconfig'
import { prettify, createLogger } from '@dexterity/logger'

import dexProject from './package.json'

argv.version(dexProject.version)
argv.info(dexProject.description)

argv.option([
    {
        name: 'log',
        short: 'l',
        type: 'string',
        description:
            'Level of logging to print [error, warn, info, verbose, debug, silly]',
        example: '--log=level-name',
    },
])

const { options: { log: level = 'info' } } = argv.run()
const logger = createLogger({ level })

logger.info('Dex CLI')

const explorer = cosmiconfig('dex')
explorer
    .search()
    .then(results => {
        if (!results) return logger.warn('No Dex config file found')

        logger.info('Config file loaded')
        return logger.debug(prettify(results))
    })
    .catch(err => {
        logger.error('Error loading config file')
        logger.error(prettify(err))
    })
